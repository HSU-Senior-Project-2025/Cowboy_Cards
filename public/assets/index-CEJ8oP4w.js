import{t as $s,c as Bs,r as l,j as e,a as Pe,S as zs,R as ds,u as us,C as Xe,L as xe,b as Ks,d as ve,e as Ne,I as U,f as L,g as Vs,h as De,i as ue,k as v,l as D,m as Gs,n as se,o as Qs,p as We,q as rs,s as Js,v as we,w as B,x as Ys,y as Hs,z as Ws,A as Xs,B as Zs,D as et,E as st,$ as tt,V as ms,F as xs,G as hs,H as fs,X as gs,T as js,J as ps,P as at,K as ys,M as rt,N as X,O as ae,Q as re,U as ge,W as nt,Y as lt,Z as z,_ as ot,a0 as it,a1 as me,a2 as Ze,a3 as es,a4 as ct,a5 as Le,a6 as ws,a7 as pe,a8 as vs,a9 as dt,aa as ut,ab as mt,ac as xt,ad as ht,ae as O,af as V,ag as G,ah as K,ai as ft,aj as Ns,ak as Te,al as ss,am as he,an as bs,ao as gt,ap as jt,aq as pt,ar as yt,as as Cs,at as wt,au as Ae,av as Ss,aw as vt,ax as Nt,ay as ns,az as bt,aA as Ct,aB as St,aC as kt,aD as It,aE as Et,aF as R,aG as Dt}from"./nm-c-7zOylu.js";import"./index-CEJ8oP4w.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();function Wa(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function E(...s){return $s(Bs(s))}const Tt=Pe("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),_e=l.forwardRef(({className:s,variant:a,...t},r)=>e.jsx("div",{ref:r,role:"alert",className:E(Tt({variant:a}),s),...t}));_e.displayName="Alert";const At=l.forwardRef(({className:s,...a},t)=>e.jsx("h5",{ref:t,className:E("mb-1 font-medium leading-none tracking-tight",s),...a}));At.displayName="AlertTitle";const Fe=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:E("text-sm [&_p]:leading-relaxed",s),...a}));Fe.displayName="AlertDescription";const Pt=Pe("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),te=l.forwardRef(({className:s,variant:a,size:t,asChild:r=!1,...n},o)=>{const c=r?zs:"button";return e.jsx(c,{className:E(Pt({variant:a,size:t,className:s})),ref:o,...n})});te.displayName="Button";const fe=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:E("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a}));fe.displayName="Card";const Oe=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:E("flex flex-col space-y-1.5 p-6",s),...a}));Oe.displayName="CardHeader";const qe=l.forwardRef(({className:s,...a},t)=>e.jsx("h3",{ref:t,className:E("text-2xl font-semibold leading-none tracking-tight",s),...a}));qe.displayName="CardTitle";const Re=l.forwardRef(({className:s,...a},t)=>e.jsx("p",{ref:t,className:E("text-sm text-muted-foreground",s),...a}));Re.displayName="CardDescription";const Ue=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:E("p-6 pt-0",s),...a}));Ue.displayName="CardContent";const Me=l.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:E("flex items-center p-6 pt-0",s),...a}));Me.displayName="CardFooter";const H=l.forwardRef(({className:s,type:a,...t},r)=>e.jsx("input",{type:a,className:E("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...t}));H.displayName="Input";const Lt=Pe("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),W=l.forwardRef(({className:s,...a},t)=>e.jsx(ds,{ref:t,className:E(Lt(),s),...a}));W.displayName=ds.displayName;const _t=1,Ft=1e6;let Ye=0;function Ot(){return Ye=(Ye+1)%Number.MAX_SAFE_INTEGER,Ye.toString()}const He=new Map,ls=s=>{if(He.has(s))return;const a=setTimeout(()=>{He.delete(s),ye({type:"REMOVE_TOAST",toastId:s})},Ft);He.set(s,a)},qt=(s,a)=>{switch(a.type){case"ADD_TOAST":return{...s,toasts:[a.toast,...s.toasts].slice(0,_t)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(t=>t.id===a.toast.id?{...t,...a.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=a;return t?ls(t):s.toasts.forEach(r=>{ls(r.id)}),{...s,toasts:s.toasts.map(r=>r.id===t||t===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return a.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(t=>t.id!==a.toastId)}}},Ie=[];let Ee={toasts:[]};function ye(s){Ee=qt(Ee,s),Ie.forEach(a=>{a(Ee)})}function Rt({...s}){const a=Ot(),t=n=>ye({type:"UPDATE_TOAST",toast:{...n,id:a}}),r=()=>ye({type:"DISMISS_TOAST",toastId:a});return ye({type:"ADD_TOAST",toast:{...s,id:a,open:!0,onOpenChange:n=>{n||r()}}}),{id:a,dismiss:r,update:t}}function $e(){const[s,a]=l.useState(Ee);return l.useEffect(()=>(Ie.push(a),()=>{const t=Ie.indexOf(a);t>-1&&Ie.splice(t,1)}),[s]),{...s,toast:Rt,dismiss:t=>ye({type:"DISMISS_TOAST",toastId:t})}}const os={method:"GET",headers:{},credentials:"include"},Ut="https://cowboy-cards.dsouth.org";async function N(s="",a=os){const t={...os,...a};try{const r=await fetch(Ut+s,t);if(!r.ok){console.log("resp",r);const o=await r.text();throw new Error(`HTTP error! Status: ${r.status}, Message: ${o}`)}return r.status===204?null:await r.json()}catch(r){throw console.error("API request failed:",r),r}}const Mt="modulepreload",$t=function(s,a){return new URL(s,a).href},is={},Xa=function(a,t,r){let n=Promise.resolve();if(t&&t.length>0){const c=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),x=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));n=Promise.allSettled(t.map(i=>{if(i=$t(i,r),i in is)return;is[i]=!0;const h=i.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(!!r)for(let d=c.length-1;d>=0;d--){const p=c[d];if(p.href===i&&(!h||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${f}`))return;const u=document.createElement("link");if(u.rel=h?"stylesheet":Mt,h||(u.as="script"),u.crossOrigin="",u.href=i,x&&u.setAttribute("nonce",x),document.head.appendChild(u),h)return new Promise((d,p)=>{u.addEventListener("load",d),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${i}`)))})}))}function o(c){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=c,window.dispatchEvent(m),!m.defaultPrevented)throw c}return n.then(c=>{for(const m of c||[])m.status==="rejected"&&o(m.reason);return a().catch(o)})},ks=()=>{const[s,a]=l.useState(!0),[t,r]=l.useState(!1),[n,o]=l.useState(""),[c,m]=l.useState(""),[x,i]=l.useState(""),[h,f]=l.useState(""),[g,u]=l.useState(""),[d,p]=l.useState({}),j=us(),{toast:C}=$e(),y=()=>{const S={};let k=!0;return n?/\S+@\S+\.\S+/.test(n)||(S.email="Email is invalid",k=!1):(S.email="Email is required",k=!1),c?c.length<8&&(S.password="Password must be at least 8 characters",k=!1):(S.password="Password is required",k=!1),!s&&!x&&(S.username="Username is required",k=!1),p(S),k},Z=async S=>{if(S.preventDefault(),!!y()){r(!0),p({});try{let k;s?k=await N("/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:n,password:c})}):k=await N("/signup",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:x,email:n,password:c,first_name:h,last_name:g})}),C({duration:8e3,title:s?"Welcome back!":"Account created",description:s?"You have been successfully logged in.":"Your account has been created successfully."}),j.push("/home")}catch(k){console.error("Authentication error:",k),p(k),Object.keys(d).length===0&&p({general:k.message||"An unexpected error occurred. Please try again."}),C({title:"Authentication failed",description:k.message||"Please check your credentials and try again.",variant:"destructive"})}finally{r(!1)}}},$=()=>{p({}),s?(i(""),f(""),u("")):(o(""),m(""))};return e.jsxs(fe,{className:"w-11/12 max-w-[350px] mb-8",children:[e.jsxs(Oe,{children:[e.jsx(qe,{className:"text-4xl tracking-wide font-smokum font-bold",children:s?"Welcome back":"Create account"}),e.jsx(Re,{children:s?"Enter your credentials to continue":"Sign up for a new account"})]}),e.jsxs("form",{onSubmit:Z,children:[e.jsxs(Ue,{className:"space-y-4",children:[d.general&&e.jsxs(_e,{variant:"destructive",className:"mb-4",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx(Fe,{children:d.general})]}),!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"username",children:"Username"}),e.jsx(H,{id:"username",type:"text",placeholder:"johndoe",value:x,onChange:S=>i(S.target.value),required:!0,className:d.username?"border-red-500":""}),d.username&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"firstName",children:"First Name"}),e.jsx(H,{id:"firstName",type:"text",placeholder:"John",value:h,onChange:S=>f(S.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"lastName",children:"Last Name"}),e.jsx(H,{id:"lastName",type:"text",placeholder:"Doe",value:g,onChange:S=>u(S.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"email",children:"Email"}),e.jsx(H,{id:"email",type:"email",placeholder:"name@example.com",value:n,onChange:S=>o(S.target.value),required:!0,className:d.email?"border-red-500":""}),d.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"password",children:"Password"}),e.jsx(H,{id:"password",type:"password",value:c,onChange:S=>m(S.target.value),required:!0,className:d.password?"border-red-500":""}),d.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.password}),!s&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Password must be at least 8 characters long"})]}),s&&e.jsx(xe,{to:"/reset-password",className:"text-sm text-primary",children:"Forgot password?"})]}),e.jsxs(Me,{className:"flex flex-col space-y-4",children:[e.jsxs(te,{type:"submit",className:"w-full",disabled:t,children:[e.jsx(Ks,{className:"mr-2 h-4 w-4"}),t?s?"Signing in...":"Signing up...":s?"Sign in":"Sign up"]}),e.jsx(te,{variant:"link",type:"button",onClick:()=>{a(!s),$()},className:"text-sm",disabled:t,children:s?"Need an account? Sign up":"Already have an account? Sign in"})]})]})]})},Bt=()=>{var j;const a=((j=ve().state)==null?void 0:j.email)||"",[t,r]=l.useState(""),[n,o]=l.useState(""),[c,m]=l.useState(""),[x,i]=l.useState(!1),[h,f]=l.useState({}),g=Ne(),{toast:u}=$e(),d=()=>{const C={};let y=!0;return c||(C.token="Reset token is required",y=!1),t?t.length<8&&(C.password="Password must be at least 8 characters",y=!1):(C.password="Password is required",y=!1),n?t!==n&&(C.confirmPassword="Passwords do not match",y=!1):(C.confirmPassword="Please confirm your password",y=!1),f({...h,...C}),y},p=async C=>{if(C.preventDefault(),!!d()){i(!0),f({});try{await N("/reset-password",{method:"POST",headers:{password:t,token:c,email:a}}),u({title:"Password reset successful",description:"Your password has been reset. You can now log in with your new password."}),g.push("/")}catch(y){console.error("Password reset error:",y),y.message==="Invalid token"?f({token:"Invalid or expired token"}):f({general:y.message||"An error occurred during password reset. Please try again."}),u({title:"Password reset failed",description:y.message||"Please check your inputs and try again.",variant:"destructive"})}finally{i(!1)}}};return e.jsx(U,{children:e.jsx(L,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsxs(fe,{className:"w-[350px]",children:[e.jsxs(Oe,{children:[e.jsx(qe,{children:"Reset Your Password"}),e.jsx(Re,{children:"Enter your new password and the reset token sent to your email"})]}),e.jsxs("form",{onSubmit:p,children:[e.jsxs(Ue,{className:"space-y-4",children:[h.general&&e.jsxs(_e,{variant:"destructive",className:"mb-4",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx(Fe,{children:h.general})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"token",children:"Reset Token"}),e.jsx(H,{id:"token",type:"text",placeholder:"Enter the token from your email",value:c,onChange:C=>m(C.target.value),required:!0,className:h.token?"border-red-500":""}),h.token&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.token})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"password",children:"New Password"}),e.jsx(H,{id:"password",type:"password",placeholder:"Enter your new password",value:t,onChange:C=>r(C.target.value),required:!0,className:h.password?"border-red-500":""}),h.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.password}),e.jsx("p",{className:"text-xs text-gray-500",children:"Password must be at least 8 characters long"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(H,{id:"confirmPassword",type:"password",placeholder:"Confirm your new password",value:n,onChange:C=>o(C.target.value),required:!0,className:h.confirmPassword?"border-red-500":""}),h.confirmPassword&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.confirmPassword})]})]}),e.jsx(Me,{className:"flex flex-col space-y-4",children:e.jsx(te,{type:"submit",className:"w-full",disabled:x,children:x?"Processing...":"Reset password"})})]})]})})})})},zt=()=>{const[s,a]=l.useState(""),[t,r]=l.useState({}),[n,o]=l.useState(!1),{toast:c}=$e(),m=Ne(),x=()=>{const h={};let f=!0;return s?/\S+@\S+\.\S+/.test(s)||(h.email="Email is invalid",f=!1):(h.email="Email is required",f=!1),r(h),f},i=async h=>{if(h.preventDefault(),!!x()){o(!0),r({});try{await N("/send-reset-password-token",{method:"POST",headers:{email:s}}),c({title:"Reset token sent",description:"If the email exists in our system, a reset token has been sent to it."}),m.push("/confirm-reset-password",{email:s})}catch(f){console.error("Reset password request error:",f);let g="An unexpected error occurred. Please try again.";f.message&&(f.message.includes("Invalid email")?g="The provided email address is not registered.":f.message.includes("Database connection error")?g="Unable to connect to the server. Please try again later.":g=f.message),r({general:g})}finally{o(!1)}}};return e.jsx(U,{children:e.jsx(L,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsxs(fe,{className:"w-11/12 max-w-[350px]",children:[e.jsxs(Oe,{children:[e.jsx(qe,{className:"text-4xl tracking-wide font-smokum font-bold",children:"Reset password"}),e.jsx(Re,{children:"Enter your email to reset your password"})]}),e.jsxs("form",{onSubmit:i,children:[e.jsxs(Ue,{className:"space-y-4",children:[t.general&&e.jsxs(_e,{variant:"destructive",className:"mb-4",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx(Fe,{children:t.general})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"email",children:"Email"}),e.jsx(H,{id:"email",type:"email",placeholder:"name@example.com",value:s,onChange:h=>a(h.target.value),required:!0,className:t.email?"border-red-500":""}),t.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.email})]})]}),e.jsx(Me,{className:"flex flex-col space-y-4",children:e.jsx(te,{type:"submit",className:"w-full",disabled:n,children:n?"Sending...":"Send reset token"})})]})]})})})})},Q=()=>{const s=ve();return s.pathname==="/"||s.pathname==="/reset-password"||s.pathname==="/confirm-reset-password"?null:e.jsx(Vs,{className:"hidden md:flex ion-no-border",children:e.jsxs(De,{children:[e.jsx(ue,{slot:"start",children:e.jsx(v,{children:e.jsx(xe,{to:"/home",children:e.jsx(D,{icon:Gs})})})}),e.jsx(se,{className:"mx-auto text-center text-sm",children:"©Cowboy Cards 2025. Built for learning and fun."})]})})},Is=l.createContext(void 0);function Kt({children:s}){const[a,t]=l.useState(()=>localStorage.getItem("theme")||"light");return l.useEffect(()=>{localStorage.setItem("theme",a),a==="dark"?(document.documentElement.classList.add("dark"),document.body.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.body.classList.remove("dark"))},[a]),e.jsx(Is.Provider,{value:{theme:a,setTheme:t},children:s})}function Es(){const s=l.useContext(Is);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s}const J=()=>{const[s,a]=l.useState(null),t=ve(),r=us(),{theme:n,setTheme:o}=Es();if(t.pathname==="/"||t.pathname==="/reset-password"||t.pathname==="/confirm-reset-password")return null;const c=h=>a(h.nativeEvent),m=()=>a(null),x=h=>{var f;r.push(h),(f=document.querySelector("ion-menu"))==null||f.close()},i=()=>{o(n==="dark"?"light":"dark")};return e.jsxs(e.Fragment,{children:[e.jsxs(Qs,{side:"start",contentId:"main-content",children:[e.jsx(We,{children:e.jsx(De,{children:e.jsx(ue,{slot:"start",children:e.jsx(rs,{children:e.jsx(v,{children:e.jsx(D,{icon:Js})})})})})}),e.jsx(L,{children:e.jsxs(we,{children:[e.jsx(B,{button:!0,onClick:()=>x("/home"),children:"My Dashboard"}),e.jsx(B,{button:!0,onClick:()=>x("/public-cards"),children:"Public Cards"}),e.jsx(B,{button:!0,onClick:()=>x("/public-classes"),children:"Public Classes"}),e.jsx(B,{button:!0,onClick:()=>x("/user-account"),children:"My Account"})]})})]}),e.jsx(We,{children:e.jsxs(De,{children:[e.jsx(ue,{slot:"start",children:e.jsx(rs,{children:e.jsx(v,{children:e.jsx(D,{icon:Ys})})})}),e.jsxs("div",{className:"cursor-pointer",onClick:()=>r.push("/home"),children:[e.jsx("img",{src:"/Spirit-Cowboy-Profile-Only.png",alt:"Cowboy Cards Logo",className:"h-8 w-auto me:hidden block"}),e.jsx("h2",{className:"hidden me:block text-2xl sm:text-3xl md:text-4xl text-ellipsis overflow-hidden whitespace-nowrap font-ewert text-[color:--ion-color-primary]",children:"Cowboy Cards"})]}),e.jsxs(ue,{slot:"end",children:[e.jsx(v,{onClick:c,children:e.jsx(D,{icon:Hs,className:"text-[32px] stroke-[2]"})}),e.jsx(Ws,{event:s,isOpen:!!s,onDidDismiss:m,children:e.jsx(L,{children:e.jsxs(we,{children:[e.jsx(B,{button:!0,onClick:()=>{m(),r.push("/create-set")},children:"Create Set"}),e.jsx(B,{button:!0,onClick:()=>{m(),r.push("/create-class")},children:"Create Class"}),e.jsx(B,{button:!0,onClick:()=>{m(),r.push("/public-classes")},children:"Join Class"})]})})}),e.jsx(v,{fill:"clear",onClick:i,children:e.jsx(D,{slot:"icon-only",icon:n==="dark"?Xs:Zs})})]}),e.jsx(ue,{slot:"end",children:e.jsx(v,{routerLink:"/user-account",children:e.jsx(D,{icon:et,size:"large"})})})]})})]})},Vt=({...s})=>{const{theme:a="system"}=st();return e.jsx(tt,{theme:a,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s})},Gt=at,Ds=l.forwardRef(({className:s,...a},t)=>e.jsx(ms,{ref:t,className:E("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...a}));Ds.displayName=ms.displayName;const Qt=Pe("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Ts=l.forwardRef(({className:s,variant:a,...t},r)=>e.jsx(xs,{ref:r,className:E(Qt({variant:a}),s),...t}));Ts.displayName=xs.displayName;const Jt=l.forwardRef(({className:s,...a},t)=>e.jsx(hs,{ref:t,className:E("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...a}));Jt.displayName=hs.displayName;const As=l.forwardRef(({className:s,...a},t)=>e.jsx(fs,{ref:t,className:E("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...a,children:e.jsx(gs,{className:"h-4 w-4"})}));As.displayName=fs.displayName;const Ps=l.forwardRef(({className:s,...a},t)=>e.jsx(js,{ref:t,className:E("text-sm font-semibold",s),...a}));Ps.displayName=js.displayName;const Ls=l.forwardRef(({className:s,...a},t)=>e.jsx(ps,{ref:t,className:E("text-sm opacity-90",s),...a}));Ls.displayName=ps.displayName;function Yt(){const{toasts:s}=$e();return e.jsxs(Gt,{children:[s.map(function({id:a,title:t,description:r,action:n,...o}){return e.jsxs(Ts,{...o,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(Ps,{children:t}),r&&e.jsx(Ls,{children:r})]}),n,e.jsx(As,{})]},a)}),e.jsx(Ds,{})]})}const Ht=rt,Wt=l.forwardRef(({className:s,sideOffset:a=4,...t},r)=>e.jsx(ys,{ref:r,sideOffset:a,className:E("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));Wt.displayName=ys.displayName;function Xt(s){return X({queryKey:["class",s],queryFn:()=>N("/api/classes/",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function Zt(s){return X({queryKey:["classSets",s],queryFn:()=>N("/api/class_set/list_sets",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function ea(s){return X({queryKey:["classMembers",s],queryFn:()=>N("/api/class_user/members",{method:"GET",headers:{class_id:s}}),staleTime:5*60*1e3})}function sa(s){return X({queryKey:["classLeaderboard",s],queryFn:()=>N("/api/classes/leaderboard",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function _s(){return X({queryKey:["userSets"],queryFn:()=>N("/api/set_user/list"),staleTime:5*60*1e3})}function ta(){return X({queryKey:["userClasses"],queryFn:()=>N("/api/class_user/classes"),staleTime:5*60*1e3})}function aa(){const s=ae();return re({mutationFn:({id:a,field:t,value:r})=>N(`/api/classes/${t}`,{method:"PUT",headers:{id:a,[t]:r}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["class",t.id]})}})}function ra(s){const a=ae();return re({mutationFn:t=>N("/api/class_user/",{method:"DELETE",headers:{student_id:t,class_id:s}}),onSuccess:()=>{a.invalidateQueries({queryKey:["classMembers",s]})}})}function na(){const s=ae();return re({mutationFn:({classId:a,setId:t})=>N("/api/class_set/",{method:"POST",headers:{class_id:a,set_id:t.toString()}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["classSets",t.classId]})}})}const la=s=>{const[a,t]=l.useState(null),[r]=ge(),{data:n=[],isLoading:o,error:c}=_s(),m=na();console.log("userSets",n),console.log("addSetMutation",m.data);const x=Array.isArray(n)?n.filter(g=>Array.isArray(s.existingSetIds)?!s.existingSetIds.includes(g.SetID):!0):[];l.useEffect(()=>{s.isOpen||t(null)},[s.isOpen]);const i=async()=>{if(!a||!s.classId){r({message:"Please select a set to add.",duration:2e3,color:"warning"});return}try{await m.mutateAsync({classId:s.classId,setId:a}),r({message:"Set added successfully!",duration:2e3,color:"success"}),s.onDidDismiss()}catch(g){const u=`Failed to add set: ${g instanceof Error?g.message:"Unknown error"}`;r({message:u,duration:3e3,color:"danger"})}},h=o||m.isPending,f=c||m.error;return console.log("availableSets",x),e.jsxs(nt,{isOpen:s.isOpen,onDidDismiss:s.onDidDismiss,children:[e.jsx(We,{children:e.jsxs(De,{children:[e.jsx(lt,{children:"Add Set to Class"}),e.jsx(ue,{slot:"end",children:e.jsx(v,{onClick:s.onDidDismiss,color:"medium",children:"Cancel"})})]})}),e.jsxs(L,{children:[h&&!(x!=null&&x.length)?e.jsxs("div",{className:"flex justify-center items-center h-full",children:[e.jsx(z,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading your sets..."})]}):f?e.jsx(se,{color:"danger",children:e.jsx("p",{children:f instanceof Error?f.message:String(f)})}):(x==null?void 0:x.length)===0?e.jsx("p",{className:"text-center text-gray-500 mt-4",children:"You have no available sets to add to this class. Create a new set or check if all your sets are already added."}):e.jsx(ot,{value:a,onIonChange:g=>{t(Number(g.detail.value))},children:e.jsx(we,{children:x==null?void 0:x.map(g=>e.jsxs(B,{children:[e.jsx(it,{slot:"start",value:g.SetID},g.SetID),e.jsxs(me,{children:[e.jsx("h2",{children:g.SetName}),e.jsx("p",{className:"text-sm text-gray-500",children:g.SetDescription})]})]},g.SetID))})}),f&&(x==null?void 0:x.length)>0&&e.jsx(se,{color:"danger",className:"block mt-4",children:e.jsx("p",{children:f instanceof Error?f.message:String(f)})})]}),!h&&(x==null?void 0:x.length)>0&&e.jsx("div",{className:"ion-padding",children:e.jsx(v,{expand:"block",onClick:i,disabled:!a||m.isPending,className:"ion-margin-bottom",children:m.isPending?e.jsx(z,{name:"dots"}):"Add Selected Set"})})]})},oa=s=>e.jsx("div",{className:"flex justify-between items-center mb-4",children:s.isTeacher&&e.jsxs("div",{className:"gap-2",children:[e.jsxs(v,{className:"rounded-lg flex-grow md:flex-grow-0",style:{"--border-radius":"0.5rem"},onClick:s.onAddSetClick,color:"primary",disabled:!s.classId,children:[e.jsx(D,{slot:"start",icon:Ze}),"Add Existing Set"]}),e.jsxs(v,{className:"rounded-lg flex-grow md:flex-grow-0",style:{"--border-radius":"0.5rem"},routerLink:`/create-set?classId=${s.classId}`,color:"primary",disabled:!s.classId,children:[e.jsx(D,{slot:"start",icon:es}),"Create New Set"]})]})}),le=s=>e.jsxs("div",{children:[e.jsx(B,{children:e.jsx(ct,{type:s.type,label:s.label,name:s.name,value:s.value,onIonChange:s.onChange})}),s.error&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.error})]}),ia=s=>e.jsx(e.Fragment,{children:s.isEditing?e.jsxs(e.Fragment,{children:[e.jsx(le,{type:"text",label:"Class Name",name:"class_name",value:s.updatedInfo.class_name,onChange:s.handleChange,error:s.formErrors.className}),e.jsx(le,{type:"text",label:"Class Description",name:"class_description",value:s.updatedInfo.class_description,onChange:s.handleChange,error:s.formErrors.classDescription}),s.formErrors.general&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.formErrors.general}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[e.jsx(v,{onClick:s.handleSave,color:"primary",size:"small",children:"Save"}),e.jsx(v,{onClick:s.handleCancel,color:"medium",size:"small",children:"Cancel"})]})]}):s.loading?e.jsx("div",{children:"Loading..."}):s.classData?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.loading?"Loading...":s.classData.ClassName}),s.isTeacher&&!s.isEditing&&e.jsx(D,{icon:es,size:"large",color:"primary",className:"hover:transform hover:scale-110 cursor-pointer p-2",onClick:s.handleEdit})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.loading?"Loading...":s.classData.ClassDescription}),e.jsxs(v,{className:"rounded-lg mt-4 w-auto inline-block",style:{"--border-radius":"0.5rem",maxWidth:"fit-content"},routerLink:"/home",color:"primary",children:[e.jsx(D,{slot:"start",icon:Le}),"Back"]})]})}):e.jsx("h1",{children:"Class details unavailable"})}),ca=s=>e.jsxs(ws,{value:s.selectedTab,onIonChange:a=>s.onTabChange(a.detail.value),className:"w-full mb-6",children:[e.jsxs(pe,{value:"flashcards",children:[e.jsx(D,{icon:vs,className:"mr-2"}),e.jsx(me,{children:"Flashcard Sets"})]}),e.jsxs(pe,{value:"leaderboard",children:[e.jsx(D,{icon:dt,className:"mr-2"}),e.jsx(me,{children:"Leaderboard"})]}),e.jsxs(pe,{value:"students",children:[e.jsx(D,{icon:ut,className:"mr-2"}),e.jsx(me,{children:"Students"})]})]}),da=s=>{var n,o;const a=Ne(),[t,r]=l.useState([]);return e.jsx("div",{className:"mt-6",children:s.loading?e.jsx("div",{children:"Loading..."}):(n=s.flashcardSets)!=null&&n.length?e.jsx(mt,{children:e.jsx(xt,{children:(o=s.flashcardSets.sort((c,m)=>c.ID-m.ID))==null?void 0:o.map(c=>e.jsx(ht,{size:"12",sizeMd:"6",sizeLg:"4",children:e.jsxs(O,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all duration-200 rounded-lg border shadow-sm",onClick:()=>a.push(`/set-overview/${c.ID}`,{fromClassID:s.classID}),children:[e.jsx(V,{children:e.jsx(G,{className:"text-lg font-semibold",children:c.SetName})}),e.jsx(K,{children:e.jsx("p",{className:"text-muted-foreground mb-2",children:c.SetDescription})})]})},c.ID))})}):e.jsx("p",{children:"No flashcard sets available. Create one or add an existing set to your class."})})},ua=s=>{var a;return e.jsxs(O,{className:"rounded-lg border shadow-sm",children:[e.jsx(V,{children:e.jsx(G,{className:"text-xl font-semibold",children:"Class Leaderboard"})}),e.jsx(K,{children:e.jsx(we,{className:"max-h-96 overflow-y-auto space-y-3",lines:"none",children:s.leaderboard===null?e.jsx("h1",{className:"text-center text-gray-500",children:"No scores available"}):(a=s.leaderboard)==null?void 0:a.map((t,r)=>e.jsx(ft.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:r*.1},children:e.jsxs(B,{className:"muted-item p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[r===0&&e.jsx("span",{className:"text-yellow-500 text-xl",children:"🥇"}),r===1&&e.jsx("span",{className:"text-gray-400 text-xl",children:"🥈"}),r===2&&e.jsx("span",{className:"text-orange-500 text-xl",children:"🥉"}),e.jsx("span",{className:"font-medium text-lg",children:t.Username})]}),e.jsxs("span",{slot:"end",className:"text-primary font-semibold",children:[t.ClassScore," points"]})]})},t.UserID))})})]})},ma=s=>e.jsx(e.Fragment,{children:s.loadingScores?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx(z,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Calculating scores..."})]}):e.jsx(ua,{leaderboard:s.leaderboardData})}),xa=s=>{var a;return e.jsxs(O,{className:"mt-6",children:[e.jsx(V,{children:e.jsx(G,{className:"text-xl font-semibold",children:"Class Students"})}),e.jsx(K,{children:e.jsx(we,{className:"space-y-3",lines:"none",children:(a=s.students)==null?void 0:a.map(t=>e.jsxs(B,{className:"muted-item p-3",children:[e.jsx("span",{className:"font-medium",children:t.Username}),e.jsx("span",{slot:"end",className:"text-muted-foreground",children:t.email}),s.isTeacher&&e.jsx(D,{slot:"end",icon:Ns,color:"danger",className:"cursor-pointer",onClick:()=>s.onDeleteStudent(t.UserID)})]},t.UserID))})})]})},ha=s=>{const[a,t]=l.useState({isOpen:!1,studentId:null}),r=n=>{t({isOpen:!0,studentId:n})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsx(xa,{isTeacher:s.isTeacher,students:s.students,onDeleteStudent:r})}),e.jsx(Te,{isOpen:a.isOpen,onDidDismiss:()=>t({isOpen:!1,studentId:null}),header:"Confirm Deletion",message:"Are you sure you want to remove this student from the class? This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Delete",handler:()=>{a.studentId!==null&&(s.handleActualDelete(a.studentId),console.log(`Student deletion initiated for ID: ${a.studentId}`))}}]})]})},fa=()=>{const{id:s}=ss(),[a,t]=l.useState(0),[r,n]=l.useState(),[o,c]=l.useState("flashcards"),[m,x]=l.useState(!1),[i,h]=l.useState({class_name:"",class_description:""}),[f,g]=l.useState(!1),[u,d]=l.useState({}),{data:p,isLoading:j,error:C}=Xt(s),{data:y=[],isLoading:Z,error:$}=Zt(s),{data:S=[],isLoading:k,error:oe}=ea(s),{data:ie=[],isLoading:Y,error:ce}=sa(s),b=aa(),P=ra(s),M=(p==null?void 0:p.Role)==="teacher",F=()=>{h({class_name:(p==null?void 0:p.ClassName)||"",class_description:(p==null?void 0:p.ClassDescription)||""}),x(!0)},be=()=>{const q={};let ne=!0;return i.class_name=i.class_name.trim(),i.class_description=i.class_description.trim(),i.class_name||(q.className="Class name is required",ne=!1),i.class_description||(q.classDescription="Class description is required",ne=!1),d(q),ne},ze=async()=>{if(be())try{await Promise.all([b.mutateAsync({id:s,field:"class_name",value:i.class_name}),b.mutateAsync({id:s,field:"class_description",value:i.class_description})]),x(!1)}catch{alert("Failed to update some fields. Please try again.")}},Ke=q=>{const{name:ne}=q.target,Qe=q.detail.value;h(ke=>({...ke,[ne]:Qe}))},Ve=()=>{x(!1)},Ge=async q=>{if(q!==null)try{await P.mutateAsync(q)}catch{alert("Error deleting student")}};l.useEffect(()=>{r&&r.on("select",()=>{t(r.selectedScrollSnap())})},[r]);const Ce=j||Z||k||Y,Se=C||$||oe||ce;return e.jsxs(U,{children:[e.jsx(J,{}),e.jsxs(L,{className:"ion-padding",children:[e.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-8",children:[Se&&e.jsx("div",{className:"text-red-500",children:Se.message}),e.jsxs("div",{className:"gap-4 mb-6",children:[e.jsx(ia,{classData:p,isTeacher:M,loading:Ce,handleEdit:F,isEditing:m,updatedInfo:i,formErrors:u,handleChange:Ke,handleSave:ze,handleCancel:Ve}),e.jsx(oa,{isTeacher:M,classId:s,onAddSetClick:()=>g(!0)})]}),e.jsx(ca,{selectedTab:o,onTabChange:c}),o==="leaderboard"&&e.jsx(ma,{leaderboardData:ie,loadingScores:Y}),o==="flashcards"&&e.jsx(da,{flashcardSets:y,currentCardIndex:a,setApi:n,loading:Ce,classId:s}),o==="students"&&e.jsx(ha,{isTeacher:M,students:S,handleActualDelete:Ge})]}),e.jsx(la,{isOpen:f,onDidDismiss:()=>g(!1),classId:s,existingSetIds:(y==null?void 0:y.map(q=>q.ID))||[]})]}),e.jsx(Q,{})]})},ga=()=>{const[s,a]=l.useState(!1),[t,r]=l.useState(null),[n,o]=l.useState({className:"",description:""}),[c,m]=l.useState(!1),x=async()=>{if(!s){a(!0),r(null);try{const i=await N("/api/classes",{method:"POST",headers:{class_name:n.className,class_description:n.description}});console.log("Class created successfully:",i),o({className:"",description:""}),m(!0)}catch(i){r(`Failed to create class: ${i.message}`)}finally{a(!1)}}};return e.jsxs(U,{children:[e.jsx(J,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8 max-w-4xl",children:[s&&e.jsx("div",{children:"Loading..."}),t&&e.jsx("div",{className:"text-red-500 mt-2",children:t}),e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum mb-6",children:"Create New Class"}),e.jsxs("form",{children:[e.jsx(O,{className:"mb-6 rounded-lg border shadow-sm",children:e.jsxs(K,{children:[e.jsx(he,{placeholder:"Enter Class Name",value:n.className,onIonChange:i=>o(h=>({...h,className:i.detail.value||""})),rows:1,autoGrow:!0,className:"w-full text-xl font-bold mb-2",style:{resize:"none"}}),e.jsx(he,{placeholder:"Enter Class Description",value:n.description,onIonChange:i=>o(h=>({...h,description:i.detail.value||""})),rows:1,autoGrow:!0,className:"w-full text-base mt-4",style:{resize:"none"}})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(v,{color:"primary",className:"rounded-lg shadow-sm w-full md:w-auto",onClick:x,disabled:s,children:s?"Creating...":"Create Set"})})]}),c&&e.jsx(bs,{isOpen:c,color:"success",onDidDismiss:()=>m(!1),message:"Class created successfully!",duration:2e3})]})}),e.jsx(Q,{})]})},ja=()=>{Ne();const[s,a]=l.useState(""),[t,r]=l.useState(""),[n,o]=l.useState({title:"",description:""}),[c,m]=l.useState(!1),[x,i]=l.useState(null),[h,f]=l.useState(!1),g=async()=>{if(c)return;m(!0),i(null);const u={title:"",description:""};let d=!1;if(s.trim()||(u.title="Title is required",d=!0),t.trim()||(u.description="Description is required",d=!0),o(u),d){m(!1);return}try{const p=await N("/api/flashcards/sets",{method:"POST",headers:{set_name:s,set_description:t}});a(""),r(""),f(!0)}catch(p){console.error("Error saving flashcard set:",p),i(`Failed to save flashcard set: ${p.message}`)}finally{m(!1)}};return e.jsxs(U,{children:[e.jsx(J,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8 max-w-4xl",children:[c&&e.jsx("div",{children:"Loading..."}),x&&e.jsx("div",{className:"text-red-500 mt-2",children:x}),e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum mb-6",children:"Create New Flashcard Set"}),e.jsx(O,{className:"mb-6 rounded-lg border shadow-sm",children:e.jsxs(K,{children:[e.jsx(he,{placeholder:"Enter Set Title",value:s,onIonChange:u=>a(u.detail.value),rows:1,autoGrow:!0,className:"w-full text-xl font-bold mb-2",style:{resize:"none"}}),n.title&&e.jsx(se,{color:"danger",children:e.jsx("p",{className:"text-sm mt-1",children:n.title})}),e.jsx(he,{placeholder:"Enter Set Description",value:t,onIonChange:u=>r(u.detail.value),rows:1,autoGrow:!0,className:"w-full text-base mt-4",style:{resize:"none"}}),n.description&&e.jsx(se,{color:"danger",children:e.jsx("p",{className:"text-sm mt-1",children:n.description})})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(v,{color:"primary",className:"rounded-lg shadow-sm w-full md:w-auto",onClick:g,disabled:c,children:c?"Creating...":"Create Set"})}),h&&e.jsx(bs,{isOpen:h,color:"success",onDidDismiss:()=>f(!1),message:"Set created successfully!",duration:2e3})]})}),e.jsx(Q,{})]})};function pa(s){return X({queryKey:["flashcardSet",s],queryFn:()=>N("/api/flashcards/sets/",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function ya(s){return X({queryKey:["flashcardCards",s],queryFn:()=>N("/api/flashcards/list",{method:"GET",headers:{set_id:s}}),staleTime:5*60*1e3})}function wa(){return ae(),re({mutationFn:({cardId:s,isCorrect:a})=>N(a?"/api/card_history/correct":"/api/card_history/incorrect",{method:"POST",headers:{card_id:s.toString()}})})}const va=s=>{const[a,t]=l.useState(!1),r=wa(),[n,o]=l.useState(null),c=async i=>{var h;try{await r.mutateAsync({cardId:s.cardId,isCorrect:i}),console.log(`Score update successful for card ${s.cardId}`),(h=s.onAdvance)==null||h.call(s)}catch(f){console.error(`Failed to update score for card ${s.cardId}:`,f),o(f)}},m=()=>{c(!1)},x=()=>{c(!0)};return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[n&&e.jsxs("div",{className:"text-red-500",children:["Error: ",n.message]}),e.jsxs("div",{className:`flip-card cursor-pointer ${a?"flipped":""}`,onClick:()=>t(!a),children:[e.jsx(fe,{className:"flip-card-front p-8 min-h-[300px] flex items-center justify-center text-center",children:e.jsx("p",{className:"text-xl",children:s.front})}),e.jsx(fe,{className:"flip-card-back p-8 min-h-[300px] flex items-center justify-center text-center absolute top-0 w-full",children:e.jsx("p",{className:"text-xl",children:s.back})})]}),e.jsxs("div",{className:"flex justify-center gap-4 mt-6",children:[e.jsxs(te,{variant:"outline",id:"shadcn-button",className:"w-32",onClick:m,children:[e.jsx(gs,{className:"mr-2 h-4 w-4"}),"Not yet"]}),e.jsxs(te,{id:"shadcn-button",className:"w-32",onClick:x,children:[e.jsx(gt,{className:"mr-2 h-4 w-4"}),"Got it"]})]})]})},Fs=l.createContext(null);function Be(){const s=l.useContext(Fs);if(!s)throw new Error("useCarousel must be used within a <Carousel />");return s}const Os=l.forwardRef(({orientation:s="horizontal",opts:a,setApi:t,plugins:r,className:n,children:o,...c},m)=>{const[x,i]=jt({...a,axis:s==="horizontal"?"x":"y"},r),[h,f]=l.useState(!1),[g,u]=l.useState(!1),d=l.useCallback(y=>{y&&(f(y.canScrollPrev()),u(y.canScrollNext()))},[]),p=l.useCallback(()=>{i==null||i.scrollPrev()},[i]),j=l.useCallback(()=>{i==null||i.scrollNext()},[i]),C=l.useCallback(y=>{y.key==="ArrowLeft"?(y.preventDefault(),p()):y.key==="ArrowRight"&&(y.preventDefault(),j())},[p,j]);return l.useEffect(()=>{!i||!t||t(i)},[i,t]),l.useEffect(()=>{if(i)return d(i),i.on("reInit",d),i.on("select",d),()=>{i==null||i.off("select",d)}},[i,d]),e.jsx(Fs.Provider,{value:{carouselRef:x,api:i,opts:a,orientation:s||((a==null?void 0:a.axis)==="y"?"vertical":"horizontal"),scrollPrev:p,scrollNext:j,canScrollPrev:h,canScrollNext:g},children:e.jsx("div",{ref:m,onKeyDownCapture:C,className:E("relative",n),role:"region","aria-roledescription":"carousel",...c,children:o})})});Os.displayName="Carousel";const qs=l.forwardRef(({className:s,...a},t)=>{const{carouselRef:r,orientation:n}=Be();return e.jsx("div",{ref:r,className:"overflow-hidden",children:e.jsx("div",{ref:t,className:E("flex",n==="horizontal"?"-ml-4":"-mt-4 flex-col",s),...a})})});qs.displayName="CarouselContent";const Rs=l.forwardRef(({className:s,...a},t)=>{const{orientation:r}=Be();return e.jsx("div",{ref:t,role:"group","aria-roledescription":"slide",className:E("min-w-0 shrink-0 grow-0 basis-full",r==="horizontal"?"pl-4":"pt-4",s),...a})});Rs.displayName="CarouselItem";const Na=l.forwardRef(({className:s,variant:a="outline",size:t="icon",...r},n)=>{const{orientation:o,scrollPrev:c,canScrollPrev:m}=Be();return e.jsxs(te,{ref:n,variant:a,size:t,className:E("absolute  h-8 w-8 rounded-full",o==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!m,onClick:c,...r,children:[e.jsx(pt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Previous slide"})]})});Na.displayName="CarouselPrevious";const ba=l.forwardRef(({className:s,variant:a="outline",size:t="icon",...r},n)=>{const{orientation:o,scrollNext:c,canScrollNext:m}=Be();return e.jsxs(te,{ref:n,variant:a,size:t,className:E("absolute h-8 w-8 rounded-full",o==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!m,onClick:c,...r,children:[e.jsx(yt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Next slide"})]})});ba.displayName="CarouselNext";const Ca=()=>{const{id:s}=ss(),[a]=ge(),[t,r]=l.useState(),[n,o]=l.useState(0),{data:c,isLoading:m,error:x}=pa(s),{data:i=[],isLoading:h,error:f}=ya(s),g=m||h,u=x||f;if(u){console.error("Query error:",u);let j="Unknown error";u instanceof Error&&(j=u.message),a({message:`Error loading data: ${j}`,duration:3e3,color:"danger"})}l.useEffect(()=>{if(!t)return;const j=()=>{o(t.selectedScrollSnap())};return j(),t.on("select",j),t.on("reInit",j),()=>{t.off("select",j),t.off("reInit",j)}},[t]);const d=()=>{t&&i.length>0&&(n===i.length-1?a({message:"Congratulations! You have completed the set.",duration:3e3,color:"success"}):t.scrollNext())},p=i.length?Math.round((n+1)/i.length*100):0;return e.jsxs(U,{children:[e.jsx(J,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(v,{className:"rounded-lg",style:{"--border-radius":"0.5rem"},routerLink:`/set-overview/${s}`,children:[e.jsx(D,{slot:"start",icon:Le}),"Back"]}),e.jsx("div",{children:g?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(z,{name:"dots"}),e.jsx(z,{name:"dots"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl font-bold",children:c==null?void 0:c.SetName}),e.jsx("p",{className:"text-gray-500",children:c==null?void 0:c.SetDescription})]})})]}),e.jsx("div",{className:"w-full max-w-xl mx-auto relative py-8 min-h-[400px] flex flex-col items-center justify-center",children:g?e.jsx(z,{name:"circular"}):i.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg py-20",children:"This set has no cards yet."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full mb-4 bg-gray-200 rounded-full h-2.5 dark:bg-gray-700",children:e.jsx("div",{className:"bg-primary h-2.5 rounded-full transition-all duration-300",style:{width:`${p}%`}})}),e.jsxs("div",{className:"text-sm text-gray-500 mb-4",children:["Card ",n+1," of ",i.length]}),e.jsx(Os,{orientation:"vertical",setApi:r,className:"w-full",children:e.jsx(qs,{className:"-mt-1 h-[400px]",children:i==null?void 0:i.map((j,C)=>e.jsx(Rs,{children:e.jsx(va,{front:j.Front,back:j.Back,onAdvance:d,cardId:j.ID})},C))})})]})})]})}),e.jsx(Q,{})]})},Sa=()=>{const[s,a]=l.useState("classes"),[t,r]=l.useState([]),[n,o]=l.useState([]),[c,m]=l.useState(!1),[x,i]=l.useState(!1),[h,f]=l.useState(null),g=async()=>{m(!0),f(null);try{const d=await N("/api/class_user/classes");console.log("Classes: ",d),r(d)}catch(d){f(`Error fetching classes: ${d.message}`)}finally{m(!1)}},u=async()=>{i(!0);try{const d=await N("/api/set_user/list");console.log("Sets: ",d),o(d)}catch(d){f(`Error fetching sets: ${d.message}`)}finally{i(!1)}};return l.useEffect(()=>{g(),u()},[]),Cs(()=>{g(),u()}),e.jsxs(U,{children:[e.jsx(J,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8 flex-grow",children:[h&&e.jsx("div",{className:"text-red-500 mt-2",children:h}),e.jsxs("div",{className:"flex flex-col me:flex-row me:justify-between me:items-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-smokum font-bold",children:s==="classes"?"My Classes":"My Flashcard Sets"}),e.jsx("div",{className:"flex items-center gap-2 mt-4 me:mt-0",children:e.jsxs(v,{color:"primary",className:"rounded-lg",style:{"--border-radius":"0.5rem"},routerLink:s==="classes"?"/public-classes":"/public-cards",children:[e.jsx(D,{slot:"start",icon:Ze})," ",s==="classes"?"Join Class":"Join Set"]})})]}),e.jsx("div",{className:"mb-8",children:e.jsxs(ws,{value:s,onIonChange:d=>a(d.detail.value||"classes"),style:{"--background":"var(--ion-color-light)"},children:[e.jsxs(pe,{value:"classes",children:[e.jsx(D,{icon:wt,className:"mr-2"}),e.jsx(me,{children:"My Classes"})]}),e.jsxs(pe,{value:"flashcards",children:[e.jsx(D,{icon:vs,className:"mr-2"}),e.jsx(me,{children:"My Cards"})]})]})}),s==="classes"&&e.jsx(e.Fragment,{children:c?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx(z,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading classes..."})]}):t===null?e.jsx("div",{className:"text-center p-8 text-gray-600",children:"You are not part of any classes. Join a class to get started."}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t==null?void 0:t.map(d=>e.jsx(xe,{to:`/class/${d.ClassID}`,children:e.jsxs(O,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:[e.jsxs(V,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(G,{className:"text-2xl font-semibold leading-none tracking-tight",children:d.ClassName}),e.jsx(Ae,{className:"text-sm text-muted-foreground",children:d.ClassDescription})]}),e.jsx(K,{})]})},d.ClassID))})}),s==="flashcards"&&e.jsx(e.Fragment,{children:x?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx(z,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading sets..."})]}):n===null?e.jsx("div",{className:"text-center p-8 text-gray-600",children:"You are not part of any sets. Join a set to get started."}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:n==null?void 0:n.map(d=>e.jsx(xe,{to:`/set-overview/${d.SetID}`,children:e.jsxs(O,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:[e.jsxs(V,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(G,{className:"text-2xl font-semibold leading-none tracking-tight",children:d.SetName}),e.jsx(Ae,{className:"text-sm text-muted-foreground",children:d.SetDescription})]}),e.jsx(K,{})]})},d.SetID))})})]})}),e.jsx(Q,{})]})},ka=()=>e.jsx(U,{children:e.jsx(L,{children:e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center from-white to-gray-50",children:[e.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16 mt-6 sm:mt-10 md:mt-14 mx-2",children:[e.jsx("h1",{className:"text-5xl sm:text-6xl md:text-7xl text-primary mb-4 font-ewert",children:"Cowboy Cards"}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-rye",children:"Master any subject with smart flashcards"})]}),e.jsx(ks,{})]})})}),Ia=()=>{const s=ve();return l.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",s.pathname)},[s.pathname]),e.jsx(U,{children:e.jsx(L,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),e.jsx("a",{href:"/home",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})})})},Ea=()=>{const[s,a]=l.useState(null),[t,r]=l.useState(!1),[n,o]=l.useState([]),[c,m]=l.useState(""),[x]=ge(),{data:i,isLoading:h}=_s(),f=n.filter(u=>u.SetName.toLowerCase().includes(c.toLowerCase())||u.SetDescription&&u.SetDescription.toLowerCase().includes(c.toLowerCase()));l.useEffect(()=>{async function u(){r(!0),a(null);try{const d=await N("/api/flashcards/sets/list");o(d)}catch(d){console.error("Error fetching flashcard sets:",d),a(`Error fetching flashcard sets: ${d.message}`)}finally{r(!1)}}u()},[]);const g=u=>i?i.some(d=>d.SetID===u):!1;return e.jsxs(U,{children:[e.jsx(J,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-0 py-8 w-4/5",children:[e.jsxs("div",{className:"flex items-center flex-col justify-between mb-4",children:[e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum pb-8",children:"Public Flashcard Sets"}),t||h&&e.jsx("div",{children:"Loading..."}),s&&e.jsx("div",{className:"text-red-500 mt-2",children:s}),e.jsx(Ss,{value:c,onIonInput:u=>m(u.target.value),placeholder:"Search flashcard sets",className:"mb-4 max-w-lg"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:f==null?void 0:f.map(u=>!g(u.ID)&&e.jsx(xe,{to:`/set-overview/${u.ID}`,children:e.jsx(O,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:e.jsxs(V,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(G,{className:"text-2xl font-semibold leading-none tracking-tight",children:u.SetName}),e.jsx(Ae,{className:"text-sm ",children:u.SetDescription||"No description"}),e.jsx(v,{expand:"block",color:"primary",className:"mt-4",onClick:async d=>{try{const p=await N("/api/set_user",{method:"POST",headers:{set_id:u.ID,role:"user"}});console.log("Join set response:",p),x({message:"Successfully joined set",duration:2e3,color:"success"})}catch(p){console.error("Error joining set:",p)}},children:"Join Set"})]})})},u.ID))})]})}),e.jsx(Q,{})]})},Da=()=>{const[s,a]=l.useState([]),[t,r]=l.useState(!1),[n,o]=l.useState(null),[c,m]=l.useState(""),[x]=ge(),{data:i,isLoading:h}=ta(),f=u=>i?i.some(d=>d.ClassID===u):!1,g=s.filter(u=>u.ClassName.toLowerCase().includes(c.toLowerCase())||u.ClassDescription&&u.ClassDescription.toLowerCase().includes(c.toLowerCase()));return l.useEffect(()=>{(async()=>{r(!0),o(null);try{const d=await N("/api/classes/list");a(d)}catch(d){o(`Error fetching classes: ${d.message}`)}finally{r(!1)}})()},[]),e.jsxs(U,{children:[e.jsx(J,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-0 py-8 w-4/5",children:[e.jsxs("div",{className:"flex items-center flex-col justify-between mb-4",children:[e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum pb-8",children:"Public Classes"}),(t||h)&&e.jsx("div",{children:"Loading..."}),n&&e.jsx("div",{className:"text-red-500 mt-2",children:n}),e.jsx(Ss,{value:c,onIonInput:u=>m(u.target.value),placeholder:"Search classes",className:"mb-4 max-w-lg"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:g==null?void 0:g.map(u=>!f(u.ID)&&e.jsx(xe,{to:`/class/${u.ID}`,children:e.jsx(O,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:e.jsxs(V,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(G,{className:"text-2xl font-semibold leading-none tracking-tight",children:u.ClassName}),e.jsx(Ae,{className:"text-sm ",children:u.ClassDescription||"No description"}),e.jsx(v,{expand:"block",color:"primary",className:"mt-4",onClick:async()=>{try{const d=await N("/api/class_user",{method:"POST",headers:{class_id:u.ID,role:"student"}});console.log("Join class response:",d),x({message:"Successfully joined class",duration:2e3,color:"success"})}catch(d){console.error("Error joining class:",d)}},children:"Join Class"})]})})},u.ID))})]})}),e.jsx(Q,{})]})},Ta=s=>{var t;const a=Array.isArray(s.cardsToDisplay)&&s.cardsToDisplay.length>0;return e.jsx("div",{className:"mt-8 min-h-[200px]",children:s.loading?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(z,{name:"circular"})}):!a&&!s.isEditing?e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-gray-900 dark:text-gray-400 mb-4",children:"This set has no cards yet."}),s.isOwner&&e.jsx(v,{color:"primary",className:"rounded-lg",style:{"--border-radius":"0.5rem"},onClick:s.onAddCardClick,children:"Add Cards"})]}):e.jsxs("div",{className:"w-full",children:[(t=s.cardsToDisplay)==null?void 0:t.map((r,n)=>{var o,c,m,x;return s.isEditing&&s.isOwner?e.jsxs(O,{className:"mb-4 rounded-lg border shadow-sm p-4",children:[e.jsxs(B,{lines:"none",children:[e.jsxs(se,{className:"text-md font-semibold text-gray-900 dark:text-gray-300 mr-auto",children:["Card ",n+1]}),e.jsx(v,{fill:"clear",color:"danger",size:"small",onClick:()=>s.onRemoveCard(n),children:e.jsx(D,{slot:"icon-only",icon:Ns})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mt-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(he,{label:"Front",labelPlacement:"stacked",value:r.Front,onIonInput:i=>s.onCardChange(n,"Front",i.detail.value),className:`w-full border rounded-md p-2 ${(o=s.cardErrors[n])!=null&&o.front?"border-red-500":"border-gray-300"}`,autoGrow:!0,rows:3}),((c=s.cardErrors[n])==null?void 0:c.front)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.cardErrors[n].front})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(he,{label:"Back",labelPlacement:"stacked",value:r.Back,onIonInput:i=>s.onCardChange(n,"Back",i.detail.value),className:`w-full border rounded-md p-2 ${(m=s.cardErrors[n])!=null&&m.back?"border-red-500":"border-gray-300"}`,autoGrow:!0,rows:3}),((x=s.cardErrors[n])==null?void 0:x.back)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.cardErrors[n].back})]})]})]},r.ID<=0?`new-${n}`:r.ID):e.jsx(O,{className:"mb-4 rounded-lg border shadow-sm",children:e.jsxs(K,{children:[e.jsx("div",{className:"border-b border-gray-300 mb-3 pb-1 m-4",children:e.jsxs(se,{className:"text-md font-semibold text-gray-900 dark:text-gray-300",children:["Card ",n+1]})}),e.jsxs("div",{className:"flex flex-row justify-between items-start",children:[e.jsx("div",{className:"w-3/12 pr-4 border-r border-gray-300 m-4",children:e.jsx(se,{className:"block whitespace-pre-wrap text-lg text-gray-900 dark:text-gray-200",children:r.Front})}),e.jsx("div",{className:"w-9/12 pl-4 m-4",children:e.jsx(se,{className:"block whitespace-pre-wrap text-lg text-gray-900 dark:text-gray-200",children:r.Back})})]})]})},r.ID)}),s.isEditing&&s.isOwner&&e.jsxs(v,{expand:"block",onClick:s.onAddCard,className:"mt-4 rounded-lg",children:[e.jsx(D,{slot:"start",icon:Ze}),"Add New Card"]})]})})},Aa=s=>e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"rounded-lg flex-grow md:flex-grow-0",color:"primary",style:{"--border-radius":"0.5rem"},routerLink:s.studyLink,disabled:s.isEditing,children:"Study Set"}),s.isOwner&&!s.isEditing&&e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"rounded-lg flex-grow md:flex-grow-0",style:{"--border-radius":"0.5rem"},onClick:s.onEditClick,children:"Edit Set & Cards"}),e.jsx(v,{className:"rounded-lg flex-grow md:flex-grow-0",color:"danger",style:{"--border-radius":"0.5rem"},onClick:s.onDeleteClick,children:"Delete Set"})]}),s.isOwner&&s.isEditing&&e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"rounded-lg flex-grow md:flex-grow-0",color:"primary",size:"small",onClick:s.onSaveClick,children:"Save All Changes"}),e.jsx(v,{className:"rounded-lg flex-grow md:flex-grow-0",color:"medium",size:"small",onClick:s.onCancelClick,children:"Cancel"})]})]}),Pa=s=>e.jsxs("div",{className:"gap-4 flex-1 pr-4",children:[e.jsx("div",{className:"flex flex-col",children:s.loading||!s.flashcardSetData?e.jsx(z,{name:"dots"}):s.isEditing&&s.isOwner?e.jsxs(e.Fragment,{children:[e.jsx(le,{type:"text",label:"Set Name",name:"set_name",value:s.updatedInfo.set_name,onChange:s.onMetadataChange,error:s.metadataErrors.setName}),e.jsx(le,{type:"text",label:"Set Description",name:"set_description",value:s.updatedInfo.set_description,onChange:s.onMetadataChange,error:s.metadataErrors.setDescription}),s.metadataErrors.general&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.metadataErrors.general})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s.flashcardSetData.SetName||"Untitled Set"}),e.jsx("p",{className:"text-base mt-1 text-gray-700",children:s.flashcardSetData.SetDescription||"No description available"})]})}),e.jsxs(v,{className:"rounded-lg flex-grow md:flex-grow-0 mt-4",style:{"--border-radius":"0.5rem"},onClick:s.onBackClick,disabled:s.isEditing,children:[e.jsx(D,{slot:"start",icon:Le}),"Back"]})]});function La(s){return X({queryKey:["set",s],queryFn:()=>N("/api/flashcards/sets/",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function _a(s){return X({queryKey:["setCards",s],queryFn:()=>N("/api/flashcards/list",{method:"GET",headers:{set_id:s}}),staleTime:5*60*1e3})}function Fa(){const s=ae();return re({mutationFn:({id:a,field:t,value:r})=>N(`/api/flashcards/sets/${t}`,{method:"PUT",headers:{id:a,[t]:r}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["set",t.id]})}})}function Oa(){const s=ae();return re({mutationFn:({id:a,field:t,value:r})=>N(`/api/flashcards/${t}`,{method:"PUT",headers:{id:a,[t]:r}}),onSuccess:(a,t)=>{const n=s.getQueryCache().findAll({queryKey:["setCards"]}).map(o=>o.queryKey[1]).find(o=>{const c=s.getQueryData(["setCards",o]);return c==null?void 0:c.some(m=>m.ID===t.id)});n&&s.invalidateQueries({queryKey:["setCards",n]})}})}function qa(){const s=ae();return re({mutationFn:({setId:a,front:t,back:r})=>N("/api/flashcards",{method:"POST",headers:{front:t,back:r,set_id:a}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["setCards",t.setId.toString()]})}})}function Ra(){const s=ae();return re({mutationFn:a=>N("/api/flashcards",{method:"DELETE",headers:{id:a}}),onSuccess:(a,t)=>{const n=s.getQueryCache().findAll({queryKey:["setCards"]}).map(o=>o.queryKey[1]).find(o=>{const c=s.getQueryData(["setCards",o]);return c==null?void 0:c.some(m=>m.ID===t)});n&&s.invalidateQueries({queryKey:["setCards",n]})}})}function Ua(){const s=ae();return re({mutationFn:a=>N("/api/flashcards/sets/",{method:"DELETE",headers:{id:a}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["set",t]}),s.invalidateQueries({queryKey:["setCards",t]}),s.invalidateQueries({queryKey:["userSets"]})}})}const Ma=()=>{var ts;const{id:s}=ss(),a=Ne(),[t]=ge(),n=(ts=ve().state)==null?void 0:ts.fromClassId,{data:o,isLoading:c,error:m}=La(s),{data:x=[],isLoading:i,error:h}=_a(s),f=Fa(),g=Oa(),u=qa(),d=Ra(),p=Ua(),[j,C]=l.useState(!1),[y,Z]=l.useState(!1),[$,S]=l.useState([]),[k,oe]=l.useState({set_name:"",set_description:""}),[ie,Y]=l.useState({}),[ce,b]=l.useState({}),P=(o==null?void 0:o.Role)==="owner",M=c||i,F=m||h;if(F){console.error("Query error:",F);let I="Unknown error";F instanceof Error&&(I=F.message),t({message:`Error loading data: ${I}`,duration:3e3,color:"danger"})}const be=()=>{o&&(oe({set_name:o.SetName||"",set_description:o.SetDescription||""}),S(x==null?void 0:x.map(I=>({...I}))),Z(!0),Y({}),b({}))},ze=I=>{const{name:T}=I.target,A=I.detail.value??"";oe(w=>({...w,[T]:A}))},Ke=(I,T,A)=>{const w=A??"";S(_=>_==null?void 0:_.map((de,je)=>je===I?{...de,[T]:w}:de))},Ve=()=>{if(!o)return;const I={ID:0-($||[]).filter(T=>T.ID<=0).length-1,Front:"",Back:"",SetID:o.ID,CreatedAt:new Date().toISOString(),UpdatedAt:new Date().toISOString()};S(T=>[...T||[],I])},Ge=I=>{S(T=>T.filter((A,w)=>w!==I))},Ce=()=>{const I={};let T=!0;const A=k.set_name.trim(),w=k.set_description.trim();return A||(I.setName="Set name is required",T=!1),w||(I.setDescription="Set description is required",T=!1),Y(I),oe({set_name:A,set_description:w}),T},Se=()=>{const I={};let T=!0;return $.forEach((A,w)=>{const _={},de=A.Front.trim(),je=A.Back.trim();de||(_.front="Front cannot be empty",T=!1),je||(_.back="Back cannot be empty",T=!1),Object.keys(_).length>0&&(I[w]=_),(de!==A.Front||je!==A.Back)&&S(Je=>Je==null?void 0:Je.map((as,Ms)=>Ms===w?{...as,Front:de,Back:je}:as))}),b(I),T},q=async()=>{const I=Ce(),T=Se();if(!I||!T||!o){console.log("Form validation failed:",ie,ce),t({message:"Please fix validation errors before saving.",duration:3e3,color:"warning"});return}try{k.set_name!==(o.SetName||"").trim()&&await f.mutateAsync({id:s,field:"set_name",value:k.set_name}),k.set_description!==(o.SetDescription||"").trim()&&await f.mutateAsync({id:s,field:"set_description",value:k.set_description});const A=new Map((x||[]).map(w=>[w.ID,w]));for(const w of x||[])!$.some(_=>_.ID===w.ID)&&w.ID>0&&await d.mutateAsync(w.ID);for(const w of $)if(w.ID<=0)await u.mutateAsync({setId:o.ID,front:w.Front,back:w.Back});else{const _=A.get(w.ID);_&&(w.Front!==(_.Front||"").trim()&&await g.mutateAsync({id:w.ID,field:"front",value:w.Front}),w.Back!==(_.Back||"").trim()&&await g.mutateAsync({id:w.ID,field:"back",value:w.Back}))}t({message:"Set details and cards updated successfully!",duration:2e3,color:"success"}),Z(!1),Y({}),b({})}catch(A){console.error("Failed to update set:",A);let w="Unknown error during save";A instanceof Error&&(w=A.message),Y(_=>({..._,general:`Failed to save: ${w}`})),t({message:`Failed to save changes: ${w}`,duration:3e3,color:"danger"})}},ne=()=>{Z(!1),Y({}),b({})},Qe=async()=>{if(!s){console.error("Cannot delete set: ID is missing."),t({message:"Cannot delete: Set ID missing.",duration:3e3,color:"danger"});return}try{await p.mutateAsync(s),t({message:"Set deleted successfully.",duration:2e3,color:"success"}),a.push("/student-dashboard")}catch(I){console.error("Failed to delete set:",I);let T="Unknown error during deletion";I instanceof Error&&(T=I.message),t({message:`Failed to delete set: ${T}`,duration:3e3,color:"danger"})}},ke=()=>{y||(n?a.push(`/class/${n}`):a.push("/home"))},Us=y?$:x;return M&&!y?e.jsxs(U,{children:[e.jsxs(L,{className:"",children:[e.jsx(J,{}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(z,{name:"circular"})})]}),e.jsx(Q,{})]}):e.jsxs(U,{children:[e.jsx(J,{}),e.jsxs(L,{children:[e.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"gap-4 mb-6",children:[e.jsx(Pa,{loading:M,flashcardSetData:o,isEditing:y,isOwner:P,updatedInfo:k,metadataErrors:ie,onMetadataChange:ze,onBackClick:ke}),e.jsx(Aa,{isOwner:P,isEditing:y,onBackClick:ke,onEditClick:be,onSaveClick:q,onCancelClick:ne,onDeleteClick:()=>C(!0),studyLink:`/flashcards/${s}`})]}),e.jsx(Ta,{loading:M,cardsToDisplay:Us,isEditing:y,isOwner:P,cardErrors:ce,onCardChange:Ke,onAddCard:Ve,onRemoveCard:Ge,onAddCardClick:be})]}),e.jsx(Te,{isOpen:j,onDidDismiss:()=>C(!1),header:"Confirm Deletion",message:"Are you sure you want to delete this set? This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary"},{text:"Delete",role:"destructive",handler:Qe}]})]}),e.jsx(Q,{})]})},ee=s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:[s.label,":"]}),e.jsx("span",{children:s.value})]}),$a=s=>{var a,t,r,n,o,c,m,x,i,h,f,g,u,d;return e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs(O,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(V,{className:"p-6",children:e.jsx(G,{className:"text-xl font-rye font-semibold text-primary",children:"Account Information"})}),e.jsx(K,{className:"p-6 pt-0",children:s.isEditing?e.jsxs("div",{className:"space-y-4",children:[e.jsx(le,{type:"text",label:"First Name",name:"first_name",value:((a=s.updatedInfo)==null?void 0:a.first_name)||"",error:s.errors.first_name,onChange:s.handleChange}),e.jsx(le,{type:"text",label:"Last Name",name:"last_name",value:((t=s.updatedInfo)==null?void 0:t.last_name)||"",error:s.errors.last_name,onChange:s.handleChange}),e.jsx(le,{type:"text",label:"Username",name:"username",value:((r=s.updatedInfo)==null?void 0:r.username)||"",error:s.errors.username,onChange:s.handleChange}),e.jsx(le,{type:"email",label:"Email",name:"email",value:((n=s.updatedInfo)==null?void 0:n.email)||"",error:s.errors.email,onChange:s.handleChange}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(v,{onClick:s.handleSave,children:"Save Changes"})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{label:"First Name",value:(o=s.userInfo)==null?void 0:o.first_name}),e.jsx(ee,{label:"Last Name",value:(c=s.userInfo)==null?void 0:c.last_name}),e.jsx(ee,{label:"Username",value:(m=s.userInfo)==null?void 0:m.username}),e.jsx(ee,{label:"Email",value:(x=s.userInfo)==null?void 0:x.email}),e.jsxs(v,{onClick:s.handleEdit,className:"mt-4",children:[e.jsx(D,{slot:"start",icon:es}),"Edit Info"]})]})})]}),e.jsxs(O,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(V,{className:"p-6",children:e.jsx(G,{className:"text-xl font-rye font-semibold text-primary",children:"Account Stats"})}),e.jsx(K,{className:"p-6 pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(ee,{label:"Account Created",value:(i=s.userInfo)==null?void 0:i.created_at}),e.jsx(ee,{label:"Login Streak",value:(h=s.userInfo)==null?void 0:h.login_streak}),e.jsx(ee,{label:"Classes Taken",value:(f=s.userInfo)==null?void 0:f.numClasses}),e.jsx(ee,{label:"Cards Studied/Total Views",value:`${(g=s.userInfo)==null?void 0:g.cardsStudied} / ${(u=s.userInfo)==null?void 0:u.totalCardViews}`}),e.jsx(ee,{label:"Total Score",value:(d=s.userInfo)==null?void 0:d.totalScore})]})})]})]})},cs=256;function Ba(s){const[a,t]=l.useState(0),{ref:r,inView:n}=vt({threshold:.7,triggerOnce:!0});return l.useEffect(()=>{let o=1e3;if(n){const c=setTimeout(()=>t(a+1),o*=.75);a==s.streak-1&&clearTimeout(c)}},[a,s.streak,n]),e.jsxs(O,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(V,{className:"p-6",children:e.jsx(G,{className:"text-xl font-rye font-semibold text-primary",children:"Login Streak"})}),e.jsxs(K,{ref:r,className:"py-6 px-0 flex flex-row items-center justify-center gap-8",children:[e.jsx("img",{src:`/frame-${a}.png`,alt:"bonsai tree",width:cs,height:cs}),e.jsx("span",{className:"text-6xl px-4 font-rye font-extrabold text-[color:--ion-color-primary] tabular-nums -ml-[30%] me:ml-0",children:a+1})]})]})}const za=s=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 py-6",children:[e.jsx(Ba,{streak:s.streak}),e.jsxs(O,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(V,{className:"p-6",children:e.jsx(G,{className:"text-xl font-rye font-semibold text-primary",children:"Account Options"})}),e.jsx(K,{className:"p-6 pt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Nt,{label:"Theme",value:s.theme,onIonChange:a=>s.setTheme(a.detail.value),interface:"popover",placeholder:"Select Theme",children:[e.jsx(ns,{value:"light",children:"Light"}),e.jsx(ns,{value:"dark",children:"Dark"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"mr-4",children:[e.jsx("h4",{className:"text-sm font-medium text-black dark:text-white",children:"Change Your Password"}),e.jsx("p",{className:"text-xs dark:text-gray-300",children:"Reset your account password."})]}),e.jsx(v,{color:"primary",onClick:()=>s.setShowPasswordAlert(!0),children:"Change Password"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"mr-4",children:[e.jsx("h4",{className:"text-sm font-medium text-black dark:text-white",children:"Delete Your Account"}),e.jsx("p",{className:"text-xs dark:text-gray-300",children:"This will delete all account data and can't be undone."})]}),e.jsx(v,{color:"danger",onClick:()=>s.setShowDeleteAlert(!0),children:"Delete Account"})]})]})})]})]}),e.jsx(Te,{isOpen:s.showPasswordAlert,onDidDismiss:()=>s.setShowPasswordAlert(!1),header:"Change Password",inputs:[{name:"oldPassword",type:"password",placeholder:"Old Password"},{name:"newPassword",type:"password",placeholder:"New Password"},{name:"confirmPassword",type:"password",placeholder:"Confirm New Password"}],buttons:[{text:"Cancel",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Save",handler:a=>a.newPassword!==a.confirmPassword?(s.presentToast({message:"Passwords do not match",duration:2e3,color:"danger"}),!0):(console.log("Password changed"),!0)}]}),e.jsx(Te,{isOpen:s.showDeleteAlert,onDidDismiss:()=>s.setShowDeleteAlert(!1),header:"Confirm Deletion",message:"Are you sure you want to delete your account? This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Delete",handler:()=>{console.log("Account deleted")}}]})]}),Ka=()=>{const{theme:s,setTheme:a}=Es(),[t,r]=l.useState(),[n,o]=l.useState(!0),[c,m]=l.useState(null),[x,i]=l.useState(null),[h,f]=l.useState(!1),[g,u]=l.useState(!1),[d,p]=l.useState(!1),[j,C]=l.useState(t),y=b=>{i(x===b?null:b)},Z=()=>{C(t),p(!0)},$=async()=>{var P;if(!S())return;const b=["first_name","last_name","username","email"];try{const M=(P=b==null?void 0:b.filter(F=>j[F]!==t[F]))==null?void 0:P.map(F=>N(`/api/users/${F}`,{method:"PUT",headers:{[F]:j[F]}}));await Promise.all(M),r(j),p(!1)}catch(M){console.error(M),alert("Failed to update some fields. Please try again.")}},S=()=>{const b={};let P=!0;return j.first_name||(b.first_name="First name is required",P=!1),j.last_name||(b.last_name="Last name is required",P=!1),j.email?/\S+@\S+\.\S+/.test(j.email)||(b.email="Email is invalid",P=!1):(b.email="Email is required",P=!1),j.username||(b.username="Username is required",P=!1),j.first_name=j.first_name.trim(),j.last_name=j.last_name.trim(),j.email=j.email.trim(),j.username=j.username.trim(),oe(b),P},[k,oe]=l.useState({}),ie=b=>{const{name:P}=b.target,M=b.detail.value;C(F=>({...F,[P]:M}))},Y=l.useCallback(async()=>{o(!0),m(null);try{const b=await N("/api/users/",{method:"GET",headers:{}});r(b),C(b),console.log("data",b)}catch(b){console.log(`Failed to fetch User Data: ${b.message}`),m(`Failed to fetch User Data: ${b.message}`)}finally{o(!1)}},[]);Cs(()=>{console.log("UserAccount will enter, fetching data..."),Y()});const[ce]=ge();return e.jsxs(U,{children:[e.jsx(J,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("p",{className:"text-xl font-rye font-semibold text-primary",children:n?"Loading...":`Welcome back, ${(t==null?void 0:t.username)||"User"}!`})}),e.jsxs(v,{onClick:()=>window.history.back(),className:"mb-6",children:[e.jsx(D,{slot:"start",icon:Le}),"Back"]}),n&&e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx(z,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading account details..."})]}),c&&!n&&e.jsx("div",{className:"text-red-500 text-center p-4 border border-red-500 rounded-md",children:c}),!n&&!c&&t&&e.jsxs(e.Fragment,{children:[e.jsx($a,{isEditing:d,errors:k,handleChange:ie,handleSave:$,updatedInfo:j,userInfo:t,handleEdit:Z}),e.jsx(za,{streak:(t==null?void 0:t.login_streak)??0,isEditing:d,errors:k,handleChange:ie,handleSave:$,updatedInfo:j,userInfo:t,expandedClass:x,toggleClassDetails:y,showPasswordAlert:h,setShowPasswordAlert:f,showDeleteAlert:g,setShowDeleteAlert:u,theme:s,setTheme:a,presentToast:ce})]})]})}),e.jsx(Q,{})]})};bt();const Va=new Ct;function Ga(){return e.jsx(St,{client:Va,children:e.jsx(Kt,{children:e.jsxs(Ht,{children:[e.jsx(kt,{children:e.jsxs(It,{children:[e.jsxs(l.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:[e.jsx(J,{}),e.jsxs(Et,{id:"main-content",children:[e.jsx(R,{exact:!0,path:"/",component:ka}),e.jsx(R,{exact:!0,path:"/home",component:Sa}),e.jsx(R,{exact:!0,path:"/class/:id",component:fa}),e.jsx(R,{exact:!0,path:"/auth",component:ks}),e.jsx(R,{exact:!0,path:"/reset-password",component:zt}),e.jsx(R,{exact:!0,path:"/confirm-reset-password",component:Bt}),e.jsx(R,{exact:!0,path:"/public-cards",component:Ea}),e.jsx(R,{exact:!0,path:"/user-account",component:Ka}),e.jsx(R,{exact:!0,path:"/flashcards/:id",component:Ca}),e.jsx(R,{exact:!0,path:"/create-set",component:ja}),e.jsx(R,{exact:!0,path:"/create-class",component:ga}),e.jsx(R,{exact:!0,path:"/public-classes",component:Da}),e.jsx(R,{exact:!0,path:"/set-overview/:id",component:Ma}),e.jsx(R,{component:Ia})]})]}),e.jsx(Q,{})]})}),e.jsx(Yt,{}),e.jsx(Vt,{})]})})})}const Qa=document.getElementById("root"),Ja=Dt(Qa);Ja.render(e.jsx(Ga,{}));export{Xa as _,Wa as g};
//# sourceMappingURL=index-CEJ8oP4w.js.map
