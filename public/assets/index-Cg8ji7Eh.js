import{t as Qs,c as zs,r as o,j as e,a as Fe,S as Vs,R as us,u as ms,C as Xe,L as he,b as Gs,d as Ce,e as Se,I as U,f as L,g as Js,h as Pe,i as me,k as p,l as T,m as Ys,n as ae,o as Hs,p as We,q as ns,s as Ws,v as be,w as z,x as Xs,y as Zs,z as et,A as st,B as tt,D as at,E as rt,$ as nt,V as xs,F as hs,G as fs,H as gs,X as js,T as ys,J as ps,P as ot,K as ws,M as lt,N as ee,O as M,Q as ne,U as je,W as it,Y as ct,Z as $,_ as dt,a0 as ut,a1 as xe,a2 as Ze,a3 as vs,a4 as mt,a5 as _e,a6 as Ns,a7 as ve,a8 as bs,a9 as xt,aa as ht,ab as ft,ac as gt,ad as jt,ae as q,af as Y,ag as H,ah as V,ai as yt,aj as Cs,ak as Ae,al as es,am as fe,an as Ss,ao as pt,ap as wt,aq as vt,ar as Nt,as as bt,at as Le,au as ks,av as Ct,aw as St,ax as os,ay as kt,az as It,aA as Et,aB as Dt,aC as Tt,aD as Pt,aE as At,aF as R,aG as Lt}from"./nm-9c6jb8pC.js";import"./index-Cg8ji7Eh.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();function er(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function E(...s){return Qs(zs(s))}const Ft=Fe("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),qe=o.forwardRef(({className:s,variant:a,...t},r)=>e.jsx("div",{ref:r,role:"alert",className:E(Ft({variant:a}),s),...t}));qe.displayName="Alert";const _t=o.forwardRef(({className:s,...a},t)=>e.jsx("h5",{ref:t,className:E("mb-1 font-medium leading-none tracking-tight",s),...a}));_t.displayName="AlertTitle";const Oe=o.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:E("text-sm [&_p]:leading-relaxed",s),...a}));Oe.displayName="AlertDescription";const qt=Fe("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),re=o.forwardRef(({className:s,variant:a,size:t,asChild:r=!1,...n},i)=>{const c=r?Vs:"button";return e.jsx(c,{className:E(qt({variant:a,size:t,className:s})),ref:i,...n})});re.displayName="Button";const ge=o.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:E("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a}));ge.displayName="Card";const Re=o.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:E("flex flex-col space-y-1.5 p-6",s),...a}));Re.displayName="CardHeader";const Ue=o.forwardRef(({className:s,...a},t)=>e.jsx("h3",{ref:t,className:E("text-2xl font-semibold leading-none tracking-tight",s),...a}));Ue.displayName="CardTitle";const Me=o.forwardRef(({className:s,...a},t)=>e.jsx("p",{ref:t,className:E("text-sm text-muted-foreground",s),...a}));Me.displayName="CardDescription";const $e=o.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:E("p-6 pt-0",s),...a}));$e.displayName="CardContent";const Be=o.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:E("flex items-center p-6 pt-0",s),...a}));Be.displayName="CardFooter";const G=o.forwardRef(({className:s,type:a,...t},r)=>e.jsx("input",{type:a,className:E("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...t}));G.displayName="Input";const Ot=Fe("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),J=o.forwardRef(({className:s,...a},t)=>e.jsx(us,{ref:t,className:E(Ot(),s),...a}));J.displayName=us.displayName;const Rt=1,Ut=1e6;let Ye=0;function Mt(){return Ye=(Ye+1)%Number.MAX_SAFE_INTEGER,Ye.toString()}const He=new Map,ls=s=>{if(He.has(s))return;const a=setTimeout(()=>{He.delete(s),Ne({type:"REMOVE_TOAST",toastId:s})},Ut);He.set(s,a)},$t=(s,a)=>{switch(a.type){case"ADD_TOAST":return{...s,toasts:[a.toast,...s.toasts].slice(0,Rt)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(t=>t.id===a.toast.id?{...t,...a.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=a;return t?ls(t):s.toasts.forEach(r=>{ls(r.id)}),{...s,toasts:s.toasts.map(r=>r.id===t||t===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return a.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(t=>t.id!==a.toastId)}}},De=[];let Te={toasts:[]};function Ne(s){Te=$t(Te,s),De.forEach(a=>{a(Te)})}function Bt({...s}){const a=Mt(),t=n=>Ne({type:"UPDATE_TOAST",toast:{...n,id:a}}),r=()=>Ne({type:"DISMISS_TOAST",toastId:a});return Ne({type:"ADD_TOAST",toast:{...s,id:a,open:!0,onOpenChange:n=>{n||r()}}}),{id:a,dismiss:r,update:t}}function Ke(){const[s,a]=o.useState(Te);return o.useEffect(()=>(De.push(a),()=>{const t=De.indexOf(a);t>-1&&De.splice(t,1)}),[s]),{...s,toast:Bt,dismiss:t=>Ne({type:"DISMISS_TOAST",toastId:t})}}const is={method:"GET",headers:{},credentials:"include"},Kt="https://cowboy-cards.dsouth.org";async function v(s="",a=is){const t={...is,...a};try{const r=await fetch(Kt+s,t);if(!r.ok){console.log("resp",r);const i=await r.text();throw new Error(`HTTP error! Status: ${r.status}, Message: ${i}`)}return r.status===204?null:await r.json()}catch(r){throw console.error("API request failed:",r),r}}const Qt="modulepreload",zt=function(s,a){return new URL(s,a).href},cs={},sr=function(a,t,r){let n=Promise.resolve();if(t&&t.length>0){const c=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),u=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));n=Promise.allSettled(t.map(l=>{if(l=zt(l,r),l in cs)return;cs[l]=!0;const m=l.endsWith(".css"),f=m?'[rel="stylesheet"]':"";if(!!r)for(let x=c.length-1;x>=0;x--){const g=c[x];if(g.href===l&&(!m||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${f}`))return;const y=document.createElement("link");if(y.rel=m?"stylesheet":Qt,m||(y.as="script"),y.crossOrigin="",y.href=l,u&&y.setAttribute("nonce",u),document.head.appendChild(y),m)return new Promise((x,g)=>{y.addEventListener("load",x),y.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return n.then(c=>{for(const d of c||[])d.status==="rejected"&&i(d.reason);return a().catch(i)})},Is=()=>{const[s,a]=o.useState(!0),[t,r]=o.useState(!1),[n,i]=o.useState(""),[c,d]=o.useState(""),[u,l]=o.useState(""),[m,f]=o.useState(""),[j,y]=o.useState(""),[x,g]=o.useState(""),[h,N]=o.useState({}),C=ms(),{toast:oe}=Ke(),se=()=>{const b={};let k=!0;return n?/\S+@\S+\.\S+/.test(n)||(b.email="Email is invalid",k=!1):(b.email="Email is required",k=!1),c?c.length<8&&(b.password="Password must be at least 8 characters",k=!1):(b.password="Password is required",k=!1),s||(u?u!==c&&(b.confirmPassword="Passwords do not match",k=!1):(b.confirmPassword="Confirm password is required",k=!1)),!s&&!m&&(b.username="Username is required",k=!1),N(b),k},B=async b=>{if(b.preventDefault(),!!se()){r(!0),N({});try{let k;s?k=await v("/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:n,password:c})}):k=await v("/signup",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:m,email:n,password:c,first_name:j,last_name:x})}),oe({duration:8e3,title:s?"Welcome back!":"Account created",description:s?"You have been successfully logged in.":"Your account has been created successfully."}),C.push("/home")}catch(k){console.error("Authentication error:",k),N(k),Object.keys(h).length===0&&N({general:k.message||"An unexpected error occurred. Please try again."}),oe({title:"Authentication failed",description:k.message||"Please check your credentials and try again.",variant:"destructive"})}finally{r(!1)}}},Z=()=>{N({}),s?(f(""),y(""),g("")):(i(""),d(""))};return e.jsxs(ge,{className:"w-11/12 max-w-[350px] mb-8",children:[e.jsxs(Re,{children:[e.jsx(Ue,{className:"text-4xl tracking-wide font-smokum font-bold",children:s?"Welcome back":"Create account"}),e.jsx(Me,{children:s?"Enter your credentials to continue":"Sign up for a new account"})]}),e.jsxs("form",{onSubmit:B,children:[e.jsxs($e,{className:"space-y-4",children:[h.general&&e.jsxs(qe,{variant:"destructive",className:"mb-4",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx(Oe,{children:h.general})]}),!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"username",children:"Username"}),e.jsx(G,{id:"username",type:"text",placeholder:"johndoe",value:m,onChange:b=>f(b.target.value),required:!0,className:h.username?"border-red-500":""}),h.username&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"firstName",children:"First Name"}),e.jsx(G,{id:"firstName",type:"text",placeholder:"John",value:j,onChange:b=>y(b.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"lastName",children:"Last Name"}),e.jsx(G,{id:"lastName",type:"text",placeholder:"Doe",value:x,onChange:b=>g(b.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",type:"email",placeholder:"name@example.com",value:n,onChange:b=>i(b.target.value),required:!0,className:h.email?"border-red-500":""}),h.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"password",children:"Password"}),e.jsx(G,{id:"password",type:"password",value:c,onChange:b=>d(b.target.value),required:!0,className:h.password?"border-red-500":""}),h.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.password}),!s&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Password must be at least 8 characters long"})]}),!s&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(G,{id:"confirmPassword",type:"password",value:u,onChange:b=>l(b.target.value),required:!0,className:h.confirmPassword?"border-red-500":""}),h.confirmPassword&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.confirmPassword})]}),s&&e.jsx(he,{to:"/reset-password",className:"text-sm text-primary",children:"Forgot password?"})]}),e.jsxs(Be,{className:"flex flex-col space-y-4",children:[e.jsxs(re,{type:"submit",className:"w-full",disabled:t,children:[e.jsx(Gs,{className:"mr-2 h-4 w-4"}),t?s?"Signing in...":"Signing up...":s?"Sign in":"Sign up"]}),e.jsx(re,{variant:"link",type:"button",onClick:()=>{a(!s),Z()},className:"text-sm",disabled:t,children:s?"Need an account? Sign up":"Already have an account? Sign in"})]})]})]})},Vt=()=>{var h;const a=((h=Ce().state)==null?void 0:h.email)||"",[t,r]=o.useState(""),[n,i]=o.useState(""),[c,d]=o.useState(""),[u,l]=o.useState(!1),[m,f]=o.useState({}),j=Se(),{toast:y}=Ke(),x=()=>{const N={};let C=!0;return c||(N.token="Reset token is required",C=!1),t?t.length<8&&(N.password="Password must be at least 8 characters",C=!1):(N.password="Password is required",C=!1),n?t!==n&&(N.confirmPassword="Passwords do not match",C=!1):(N.confirmPassword="Please confirm your password",C=!1),f({...m,...N}),C},g=async N=>{if(N.preventDefault(),!!x()){l(!0),f({});try{await v("/reset-password",{method:"POST",headers:{password:t,token:c,email:a}}),y({title:"Password reset successful",description:"Your password has been reset. You can now log in with your new password."}),j.push("/")}catch(C){console.error("Password reset error:",C),C.message==="Invalid token"?f({token:"Invalid or expired token"}):f({general:C.message||"An error occurred during password reset. Please try again."}),y({title:"Password reset failed",description:C.message||"Please check your inputs and try again.",variant:"destructive"})}finally{l(!1)}}};return e.jsx(U,{children:e.jsx(L,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(ge,{className:"w-[350px]",children:[e.jsxs(Re,{children:[e.jsx(Ue,{children:"Reset Your Password"}),e.jsx(Me,{children:"Enter your new password and the reset token sent to your email"})]}),e.jsxs("form",{onSubmit:g,children:[e.jsxs($e,{className:"space-y-4",children:[m.general&&e.jsxs(qe,{variant:"destructive",className:"mb-4",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx(Oe,{children:m.general})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"token",children:"Reset Token"}),e.jsx(G,{id:"token",type:"text",placeholder:"Enter the token from your email",value:c,onChange:N=>d(N.target.value),required:!0,className:m.token?"border-red-500":""}),m.token&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.token})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"password",children:"New Password"}),e.jsx(G,{id:"password",type:"password",placeholder:"Enter your new password",value:t,onChange:N=>r(N.target.value),required:!0,className:m.password?"border-red-500":""}),m.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.password}),e.jsx("p",{className:"text-xs text-gray-500",children:"Password must be at least 8 characters long"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(G,{id:"confirmPassword",type:"password",placeholder:"Confirm your new password",value:n,onChange:N=>i(N.target.value),required:!0,className:m.confirmPassword?"border-red-500":""}),m.confirmPassword&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.confirmPassword})]})]}),e.jsx(Be,{className:"flex flex-col space-y-4",children:e.jsx(re,{type:"submit",className:"w-full",disabled:u,children:u?"Processing...":"Reset password"})})]})]})})})})},Gt=()=>{const[s,a]=o.useState(""),[t,r]=o.useState({}),[n,i]=o.useState(!1),{toast:c}=Ke(),d=Se(),u=()=>{const m={};let f=!0;return s?/\S+@\S+\.\S+/.test(s)||(m.email="Email is invalid",f=!1):(m.email="Email is required",f=!1),r(m),f},l=async m=>{if(m.preventDefault(),!!u()){i(!0),r({});try{await v("/send-reset-password-token",{method:"POST",headers:{email:s}}),c({title:"Reset token sent",description:"If the email exists in our system, a reset token has been sent to it."}),d.push("/confirm-reset-password",{email:s})}catch(f){console.error("Reset password request error:",f);let j="An unexpected error occurred. Please try again.";f.message&&(f.message.includes("Invalid email")?j="The provided email address is not registered.":f.message.includes("Database connection error")?j="Unable to connect to the server. Please try again later.":j=f.message),r({general:j})}finally{i(!1)}}};return e.jsx(U,{children:e.jsx(L,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(ge,{className:"w-11/12 max-w-[350px]",children:[e.jsxs(Re,{children:[e.jsx(Ue,{className:"text-4xl tracking-wide font-smokum font-bold",children:"Reset password"}),e.jsx(Me,{children:"Enter your email to reset your password"})]}),e.jsxs("form",{onSubmit:l,children:[e.jsxs($e,{className:"space-y-4",children:[t.general&&e.jsxs(qe,{variant:"destructive",className:"mb-4",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx(Oe,{children:t.general})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",type:"email",placeholder:"name@example.com",value:s,onChange:m=>a(m.target.value),required:!0,className:t.email?"border-red-500":""}),t.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.email})]})]}),e.jsx(Be,{className:"flex flex-col space-y-4",children:e.jsx(re,{type:"submit",className:"w-full",disabled:n,children:n?"Sending...":"Send reset token"})})]})]})})})})},W=()=>{const s=Ce();return s.pathname==="/"||s.pathname==="/reset-password"||s.pathname==="/confirm-reset-password"?null:e.jsx(Js,{className:"hidden md:flex ion-no-border",children:e.jsxs(Pe,{children:[e.jsx(me,{slot:"start",children:e.jsx(p,{children:e.jsx(he,{to:"/home",children:e.jsx(T,{icon:Ys})})})}),e.jsx(ae,{className:"mx-auto text-center text-sm",children:"Â©Cowboy Cards 2025. Built for learning and fun."})]})})},Es=o.createContext(void 0);function Jt({children:s}){const[a,t]=o.useState(()=>localStorage.getItem("theme")||"light");return o.useEffect(()=>{localStorage.setItem("theme",a),a==="dark"?(document.documentElement.classList.add("dark"),document.body.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.body.classList.remove("dark"))},[a]),e.jsx(Es.Provider,{value:{theme:a,setTheme:t},children:s})}function Ds(){const s=o.useContext(Es);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s}const X=()=>{const[s,a]=o.useState(null),t=Ce(),r=ms(),{theme:n,setTheme:i}=Ds();if(t.pathname==="/"||t.pathname==="/reset-password"||t.pathname==="/confirm-reset-password")return null;const c=m=>a(m.nativeEvent),d=()=>a(null),u=m=>{var f;r.push(m),(f=document.querySelector("ion-menu"))==null||f.close()},l=()=>{i(n==="dark"?"light":"dark")};return e.jsxs(e.Fragment,{children:[e.jsxs(Hs,{side:"start",contentId:"main-content",children:[e.jsx(We,{children:e.jsx(Pe,{children:e.jsx(me,{slot:"start",children:e.jsx(ns,{children:e.jsx(p,{children:e.jsx(T,{icon:Ws})})})})})}),e.jsx(L,{children:e.jsxs(be,{children:[e.jsx(z,{button:!0,onClick:()=>u("/home"),children:"My Dashboard"}),e.jsx(z,{button:!0,onClick:()=>u("/public-cards"),children:"Public Cards"}),e.jsx(z,{button:!0,onClick:()=>u("/public-classes"),children:"Public Classes"}),e.jsx(z,{button:!0,onClick:()=>u("/user-account"),children:"My Account"})]})})]}),e.jsx(We,{children:e.jsxs(Pe,{children:[e.jsx(me,{slot:"start",children:e.jsx(ns,{children:e.jsx(p,{children:e.jsx(T,{icon:Xs})})})}),e.jsxs("div",{className:"cursor-pointer",onClick:()=>r.push("/home"),children:[e.jsx("img",{src:"/Spirit-Cowboy-Profile-Only.png",alt:"Cowboy Cards Logo",className:"h-8 w-auto me:hidden block"}),e.jsx("h2",{className:"hidden me:block text-2xl sm:text-3xl md:text-4xl text-ellipsis overflow-hidden whitespace-nowrap font-ewert text-[color:--ion-color-primary]",children:"Cowboy Cards"})]}),e.jsxs(me,{slot:"end",children:[e.jsx(p,{onClick:c,children:e.jsx(T,{icon:Zs,className:"text-[32px] stroke-[2]"})}),e.jsx(et,{event:s,isOpen:!!s,onDidDismiss:d,children:e.jsx(L,{children:e.jsxs(be,{children:[e.jsx(z,{button:!0,onClick:()=>{d(),r.push("/create-set")},children:"Create Set"}),e.jsx(z,{button:!0,onClick:()=>{d(),r.push("/create-class")},children:"Create Class"}),e.jsx(z,{button:!0,onClick:()=>{d(),r.push("/public-classes")},children:"Join Class"})]})})}),e.jsx(p,{fill:"clear",onClick:l,children:e.jsx(T,{slot:"icon-only",icon:n==="dark"?st:tt})})]}),e.jsx(me,{slot:"end",children:e.jsx(p,{routerLink:"/user-account",children:e.jsx(T,{icon:at,size:"large"})})})]})})]})},Yt=({...s})=>{const{theme:a="system"}=rt();return e.jsx(nt,{theme:a,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s})},Ht=ot,Ts=o.forwardRef(({className:s,...a},t)=>e.jsx(xs,{ref:t,className:E("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...a}));Ts.displayName=xs.displayName;const Wt=Fe("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Ps=o.forwardRef(({className:s,variant:a,...t},r)=>e.jsx(hs,{ref:r,className:E(Wt({variant:a}),s),...t}));Ps.displayName=hs.displayName;const Xt=o.forwardRef(({className:s,...a},t)=>e.jsx(fs,{ref:t,className:E("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...a}));Xt.displayName=fs.displayName;const As=o.forwardRef(({className:s,...a},t)=>e.jsx(gs,{ref:t,className:E("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...a,children:e.jsx(js,{className:"h-4 w-4"})}));As.displayName=gs.displayName;const Ls=o.forwardRef(({className:s,...a},t)=>e.jsx(ys,{ref:t,className:E("text-sm font-semibold",s),...a}));Ls.displayName=ys.displayName;const Fs=o.forwardRef(({className:s,...a},t)=>e.jsx(ps,{ref:t,className:E("text-sm opacity-90",s),...a}));Fs.displayName=ps.displayName;function Zt(){const{toasts:s}=Ke();return e.jsxs(Ht,{children:[s.map(function({id:a,title:t,description:r,action:n,...i}){return e.jsxs(Ps,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(Ls,{children:t}),r&&e.jsx(Fs,{children:r})]}),n,e.jsx(As,{})]},a)}),e.jsx(Ts,{})]})}const ea=lt,sa=o.forwardRef(({className:s,sideOffset:a=4,...t},r)=>e.jsx(ws,{ref:r,sideOffset:a,className:E("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));sa.displayName=ws.displayName;function ta(s){return ee({queryKey:["class",s],queryFn:()=>v("/api/classes/",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function aa(s){return ee({queryKey:["classSets",s],queryFn:()=>v("/api/class_set/list_sets",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function ra(s){return ee({queryKey:["classMembers",s],queryFn:()=>v("/api/class_user/members",{method:"GET",headers:{class_id:s}}),staleTime:5*60*1e3})}function na(s){return ee({queryKey:["classLeaderboard",s],queryFn:()=>v("/api/classes/leaderboard",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function ss(){return ee({queryKey:["userSets"],queryFn:()=>v("/api/set_user/list"),staleTime:5*60*1e3})}function _s(){return ee({queryKey:["userClasses"],queryFn:()=>v("/api/class_user/classes"),staleTime:5*60*1e3})}function oa(){const s=M();return ne({mutationFn:({id:a,field:t,value:r})=>v(`/api/classes/${t}`,{method:"PUT",headers:{id:a,[t]:r}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["class",t.id]}),s.invalidateQueries({queryKey:["userClasses"]})}})}function la(s){const a=M();return ne({mutationFn:t=>v("/api/class_user/",{method:"DELETE",headers:{student_id:t,class_id:s}}),onSuccess:()=>{a.invalidateQueries({queryKey:["classMembers",s]}),a.invalidateQueries({queryKey:["classLeaderboard",s]}),a.invalidateQueries({queryKey:["userClasses"]})}})}function ia(){const s=M();return ne({mutationFn:({classId:a,setId:t})=>v("/api/class_set/",{method:"POST",headers:{class_id:a,set_id:t.toString()}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["classSets",t.classId]})}})}const ca=s=>{const[a,t]=o.useState(null),[r]=je(),{data:n=[],isLoading:i,error:c}=ss(),d=ia();console.log("userSets",n),console.log("addSetMutation",d.data);const u=Array.isArray(n)?n.filter(j=>Array.isArray(s.existingSetIds)?!s.existingSetIds.includes(j.SetID):!0):[];o.useEffect(()=>{s.isOpen||t(null)},[s.isOpen]);const l=async()=>{if(!a||!s.classId){r({message:"Please select a set to add.",duration:2e3,color:"warning"});return}try{await d.mutateAsync({classId:s.classId,setId:a}),r({message:"Set added successfully!",duration:2e3,color:"success"}),s.onDidDismiss()}catch(j){const y=`Failed to add set: ${j instanceof Error?j.message:"Unknown error"}`;r({message:y,duration:3e3,color:"danger"})}},m=i||d.isPending,f=c||d.error;return console.log("availableSets",u),e.jsxs(it,{isOpen:s.isOpen,onDidDismiss:s.onDidDismiss,children:[e.jsx(We,{children:e.jsxs(Pe,{children:[e.jsx(ct,{children:"Add Set to Class"}),e.jsx(me,{slot:"end",children:e.jsx(p,{onClick:s.onDidDismiss,color:"medium",children:"Cancel"})})]})}),e.jsxs(L,{children:[m&&!(u!=null&&u.length)?e.jsxs("div",{className:"flex justify-center items-center h-full",children:[e.jsx($,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading your sets..."})]}):f?e.jsx(ae,{color:"danger",children:e.jsx("p",{children:f instanceof Error?f.message:String(f)})}):(u==null?void 0:u.length)===0?e.jsx("p",{className:"text-center text-gray-500 mt-4",children:"You have no available sets to add to this class. Create a new set or check if all your sets are already added."}):e.jsx(dt,{value:a,onIonChange:j=>{t(Number(j.detail.value))},children:e.jsx(be,{children:u==null?void 0:u.map(j=>e.jsxs(z,{children:[e.jsx(ut,{slot:"start",value:j.SetID},j.SetID),e.jsxs(xe,{children:[e.jsx("h2",{children:j.SetName}),e.jsx("p",{className:"text-sm text-gray-500",children:j.SetDescription})]})]},j.SetID))})}),f&&(u==null?void 0:u.length)>0&&e.jsx(ae,{color:"danger",className:"block mt-4",children:e.jsx("p",{children:f instanceof Error?f.message:String(f)})})]}),!m&&(u==null?void 0:u.length)>0&&e.jsx("div",{className:"ion-padding",children:e.jsx(p,{expand:"block",onClick:l,disabled:!a||d.isPending,className:"ion-margin-bottom",children:d.isPending?e.jsx($,{name:"dots"}):"Add Selected Set"})})]})},da=s=>e.jsxs("div",{className:"flex flex-col items-center sm:items-end justify-end mt-4",children:[s.isTeacher&&!s.isEditing&&e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"rounded-lg mt-2 sm:mt-2 sm:ml-2 w-full sm:w-auto max-w-80",style:{"--border-radius":"0.5rem"},onClick:s.handleEdit,children:"Edit Class"}),e.jsxs(p,{className:"rounded-lg sm:ml-0 w-full sm:w-auto max-w-80",style:{"--border-radius":"0.5rem"},onClick:s.onAddSetClick,color:"primary",disabled:!s.classId,children:[e.jsx(T,{slot:"start",icon:Ze}),"Add Existing Set"]}),e.jsxs(p,{className:"rounded-lg sm:ml-0 w-full sm:w-auto max-w-80",style:{"--border-radius":"0.5rem"},routerLink:`/create-set?classId=${s.classId}`,color:"primary",disabled:!s.classId,children:[e.jsx(T,{slot:"start",icon:vs}),"Create New Set"]})]}),s.isTeacher&&s.isEditing&&e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"rounded-lg mt-2 sm:mt-2 sm:ml-2 w-full sm:w-auto max-w-80",color:"primary",size:"small",onClick:s.handleSave,children:"Save All Changes"}),e.jsx(p,{className:"rounded-lg mt-2 sm:mt-2 sm:ml-2 w-full sm:w-auto max-w-80",color:"medium",size:"small",onClick:s.handleCancel,children:"Cancel"})]})]}),ie=s=>e.jsxs("div",{children:[e.jsx(z,{children:e.jsx(mt,{type:s.type,label:s.label,name:s.name,value:s.value,onIonChange:s.onChange})}),s.error&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.error})]}),ua=s=>e.jsx("div",{className:"gap-4 flex-1 sm:pr-4",children:e.jsx("div",{className:"flex flex-col",children:s.loading||!s.classData?e.jsx($,{name:"dots"}):s.isEditing&&s.isTeacher?e.jsxs(e.Fragment,{children:[e.jsx(ie,{type:"text",label:"Class Name",name:"class_name",value:s.updatedInfo.class_name,onChange:s.handleChange,error:s.formErrors.className}),e.jsx(ie,{type:"text",label:"Class Description",name:"class_description",value:s.updatedInfo.class_description,onChange:s.handleChange,error:s.formErrors.classDescription}),s.formErrors.general&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.formErrors.general})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s.classData.ClassName||"Untitled Class"}),e.jsx("p",{className:"text-base mt-1 text-gray-700 dark:text-gray-400",children:s.classData.ClassDescription||"No description available"}),e.jsxs(p,{className:"rounded-lg mt-4 max-w-[200px]",style:{"--border-radius":"0.5rem"},routerLink:"/home",color:"primary",children:[e.jsx(T,{slot:"start",icon:_e}),"Back"]})]})})}),ma=s=>e.jsxs(Ns,{value:s.selectedTab,onIonChange:a=>s.onTabChange(a.detail.value),className:"w-full mb-6",children:[e.jsxs(ve,{value:"flashcards",children:[e.jsx(T,{icon:bs,className:"mr-2"}),e.jsx(xe,{children:"Flashcard Sets"})]}),e.jsxs(ve,{value:"leaderboard",children:[e.jsx(T,{icon:xt,className:"mr-2"}),e.jsx(xe,{children:"Leaderboard"})]}),e.jsxs(ve,{value:"students",children:[e.jsx(T,{icon:ht,className:"mr-2"}),e.jsx(xe,{children:"Students"})]})]}),xa=s=>{var n,i;const a=Se(),[t,r]=o.useState([]);return e.jsx("div",{className:"mt-6",children:s.loading?e.jsx("div",{children:"Loading..."}):(n=s.flashcardSets)!=null&&n.length?e.jsx(ft,{children:e.jsx(gt,{children:(i=s.flashcardSets.sort((c,d)=>c.ID-d.ID))==null?void 0:i.map(c=>e.jsx(jt,{size:"12",sizeMd:"6",sizeLg:"4",children:e.jsxs(q,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all duration-200 rounded-lg border shadow-sm",onClick:()=>a.push(`/set-overview/${c.ID}`,{fromClassID:s.classID}),children:[e.jsx(Y,{children:e.jsx(H,{className:"text-lg font-semibold",children:c.SetName})}),e.jsx(V,{children:e.jsx("p",{className:"text-muted-foreground mb-2",children:c.SetDescription})})]})},c.ID))})}):e.jsx("p",{children:"No flashcard sets available. Create one or add an existing set to your class."})})},ha=s=>{var a;return e.jsxs(q,{className:"rounded-lg border shadow-sm",children:[e.jsx(Y,{children:e.jsx(H,{className:"text-xl font-semibold",children:"Class Leaderboard"})}),e.jsx(V,{children:e.jsx(be,{className:"max-h-96 overflow-y-auto space-y-3",lines:"none",children:s.leaderboard===null?e.jsx("h1",{className:"text-center text-gray-500",children:"No scores available"}):(a=s.leaderboard)==null?void 0:a.map((t,r)=>e.jsx(yt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:r*.1},children:e.jsxs(z,{className:"muted-item py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r===0&&e.jsx("span",{className:"text-yellow-500 text-xl",children:"ðŸ¥‡"}),r===1&&e.jsx("span",{className:"text-gray-400 text-xl",children:"ðŸ¥ˆ"}),r===2&&e.jsx("span",{className:"text-orange-500 text-xl",children:"ðŸ¥‰"}),e.jsx("span",{className:"font-medium text-lg",children:t.Username})]}),e.jsxs("span",{slot:"end",className:"text-primary font-semibold ml-2",children:[t.ClassScore," points"]})]})},t.UserID))})})]})},fa=s=>e.jsx(e.Fragment,{children:s.loadingScores?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx($,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Calculating scores..."})]}):e.jsx(ha,{leaderboard:s.leaderboardData})}),ga=s=>{var a;return e.jsxs(q,{className:"mt-6",children:[e.jsx(Y,{children:e.jsx(H,{className:"text-xl font-semibold",children:"Class Students"})}),e.jsx(V,{children:e.jsx(be,{className:"space-y-3",lines:"none",children:(a=s.students)==null?void 0:a.map(t=>e.jsxs(z,{className:"muted-item py-3",children:[e.jsx("span",{className:"font-medium",children:t.Username}),s.isTeacher&&e.jsx(T,{slot:"end",icon:Cs,color:"danger",className:"cursor-pointer",onClick:()=>s.onDeleteStudent(t.UserID)})]},t.UserID))})})]})},ja=s=>{const[a,t]=o.useState({isOpen:!1,studentId:null}),r=n=>{t({isOpen:!0,studentId:n})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsx(ga,{isTeacher:s.isTeacher,students:s.students,onDeleteStudent:r})}),e.jsx(Ae,{isOpen:a.isOpen,onDidDismiss:()=>t({isOpen:!1,studentId:null}),header:"Confirm Deletion",message:"Are you sure you want to remove this student from the class? This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Delete",handler:()=>{a.studentId!==null&&(s.handleActualDelete(a.studentId),console.log(`Student deletion initiated for ID: ${a.studentId}`))}}]})]})},ya=()=>{const{id:s}=es(),[a,t]=o.useState(0),[r,n]=o.useState(),[i,c]=o.useState("flashcards"),[d,u]=o.useState(!1),[l,m]=o.useState({class_name:"",class_description:""}),[f,j]=o.useState(!1),[y,x]=o.useState({}),{data:g,isLoading:h,error:N}=ta(s),{data:C=[],isLoading:oe,error:se}=aa(s),{data:B=[],isLoading:Z,error:b}=ra(s),{data:k=[],isLoading:K,error:ce}=na(s),S=oa(),P=la(s),Q=(g==null?void 0:g.Role)==="teacher",_=()=>{m({class_name:(g==null?void 0:g.ClassName)||"",class_description:(g==null?void 0:g.ClassDescription)||""}),u(!0)},ye=()=>{const O={};let le=!0;return l.class_name=l.class_name.trim(),l.class_description=l.class_description.trim(),l.class_name||(O.className="Class name is required",le=!1),l.class_description||(O.classDescription="Class description is required",le=!1),x(O),le},pe=async()=>{if(ye())try{await Promise.all([S.mutateAsync({id:s,field:"class_name",value:l.class_name}),S.mutateAsync({id:s,field:"class_description",value:l.class_description})]),u(!1)}catch{alert("Failed to update some fields. Please try again.")}},de=O=>{const{name:le}=O.target,Ve=O.detail.value;m(Ge=>({...Ge,[le]:Ve}))},ke=()=>{u(!1)},ze=async O=>{if(O!==null)try{await P.mutateAsync(O)}catch{alert("Error deleting student")}};o.useEffect(()=>{r&&r.on("select",()=>{t(r.selectedScrollSnap())})},[r]);const Ie=h||oe||Z||K,Ee=N||se||b||ce;return e.jsxs(U,{children:[e.jsx(X,{}),e.jsxs(L,{children:[e.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-8",children:[Ee&&e.jsx("div",{className:"text-red-500",children:Ee.message}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx(ua,{loading:Ie,classData:g,isEditing:d,isTeacher:Q,updatedInfo:l,formErrors:y,handleChange:de}),e.jsx(da,{isTeacher:Q,isEditing:d,handleEdit:_,handleSave:pe,handleCancel:ke,classId:s,onAddSetClick:()=>j(!0)})]}),e.jsx(ma,{selectedTab:i,onTabChange:c}),i==="leaderboard"&&e.jsx(fa,{leaderboardData:k,loadingScores:K}),i==="flashcards"&&e.jsx(xa,{flashcardSets:C,currentCardIndex:a,setApi:n,loading:Ie,classId:s}),i==="students"&&e.jsx(ja,{isTeacher:Q,students:B,handleActualDelete:ze})]}),e.jsx(ca,{isOpen:f,onDidDismiss:()=>j(!1),classId:s,existingSetIds:(C==null?void 0:C.map(O=>O.ID))||[]})]}),e.jsx(W,{})]})},pa=()=>{const s=M(),[a,t]=o.useState(!1),[r,n]=o.useState(null),[i,c]=o.useState({className:"",description:""}),[d,u]=o.useState(!1),l=async()=>{if(!a){t(!0),n(null);try{const m=await v("/api/classes",{method:"POST",headers:{class_name:i.className,class_description:i.description}});console.log("Class created successfully:",m),c({className:"",description:""}),u(!0),s.invalidateQueries({queryKey:["userClasses"]})}catch(m){n(`Failed to create class: ${m.message}`)}finally{t(!1)}}};return e.jsxs(U,{children:[e.jsx(X,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8 max-w-4xl",children:[a&&e.jsx("div",{children:"Loading..."}),r&&e.jsx("div",{className:"text-red-500 mt-2",children:r}),e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum mb-6",children:"Create New Class"}),e.jsxs("form",{children:[e.jsx(q,{className:"mb-6 rounded-lg border shadow-sm",children:e.jsxs(V,{children:[e.jsx(fe,{placeholder:"Enter Class Name",value:i.className,onIonChange:m=>c(f=>({...f,className:m.detail.value||""})),rows:1,autoGrow:!0,className:"w-full text-xl font-bold mb-2",style:{resize:"none"}}),e.jsx(fe,{placeholder:"Enter Class Description",value:i.description,onIonChange:m=>c(f=>({...f,description:m.detail.value||""})),rows:1,autoGrow:!0,className:"w-full text-base mt-4",style:{resize:"none"}})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(p,{color:"primary",className:"rounded-lg shadow-sm w-full md:w-auto",onClick:l,disabled:a,children:a?"Creating...":"Create Class"})})]}),d&&e.jsx(Ss,{isOpen:d,color:"success",onDidDismiss:()=>u(!1),message:"Class created successfully!",duration:2e3})]})}),e.jsx(W,{})]})},wa=()=>{const s=M();Se();const[a,t]=o.useState(""),[r,n]=o.useState(""),[i,c]=o.useState({title:"",description:""}),[d,u]=o.useState(!1),[l,m]=o.useState(null),[f,j]=o.useState(!1),y=async()=>{if(d)return;u(!0),m(null);const x={title:"",description:""};let g=!1;if(a.trim()||(x.title="Title is required",g=!0),r.trim()||(x.description="Description is required",g=!0),c(x),g){u(!1);return}try{const h=await v("/api/flashcards/sets",{method:"POST",headers:{set_name:a,set_description:r}});t(""),n(""),j(!0),s.invalidateQueries({queryKey:["userSets"]})}catch(h){console.error("Error saving flashcard set:",h),m(`Failed to save flashcard set: ${h.message}`)}finally{u(!1)}};return e.jsxs(U,{children:[e.jsx(X,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8 max-w-4xl",children:[d&&e.jsx("div",{children:"Loading..."}),l&&e.jsx("div",{className:"text-red-500 mt-2",children:l}),e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum mb-6",children:"Create New Flashcard Set"}),e.jsx(q,{className:"mb-6 rounded-lg border shadow-sm",children:e.jsxs(V,{children:[e.jsx(fe,{placeholder:"Enter Set Title",value:a,onIonChange:x=>t(x.detail.value),rows:1,autoGrow:!0,className:"w-full text-xl font-bold mb-2",style:{resize:"none"}}),i.title&&e.jsx(ae,{color:"danger",children:e.jsx("p",{className:"text-sm mt-1",children:i.title})}),e.jsx(fe,{placeholder:"Enter Set Description",value:r,onIonChange:x=>n(x.detail.value),rows:1,autoGrow:!0,className:"w-full text-base mt-4",style:{resize:"none"}}),i.description&&e.jsx(ae,{color:"danger",children:e.jsx("p",{className:"text-sm mt-1",children:i.description})})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(p,{color:"primary",className:"rounded-lg shadow-sm w-full md:w-auto",onClick:y,disabled:d,children:d?"Creating...":"Create Set"})}),f&&e.jsx(Ss,{isOpen:f,color:"success",onDidDismiss:()=>j(!1),message:"Set created successfully!",duration:2e3})]})}),e.jsx(W,{})]})};function va(s){return ee({queryKey:["flashcardSet",s],queryFn:()=>v("/api/flashcards/sets/",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function Na(s){return ee({queryKey:["flashcardCards",s],queryFn:()=>v("/api/flashcards/list",{method:"GET",headers:{set_id:s}}),staleTime:5*60*1e3})}function ba(){const s=M();return ne({mutationFn:({cardId:a,isCorrect:t,setId:r})=>v(t?"/api/card_history/correct":"/api/card_history/incorrect",{method:"POST",headers:{card_id:a.toString(),set_id:r.toString()}}),onSuccess:()=>{s.invalidateQueries({queryKey:["userSets"]}),s.invalidateQueries({queryKey:["classLeaderboard"]})}})}const Ca=s=>{const[a,t]=o.useState(!1),r=ba(),[n,i]=o.useState(null),c=s.setId,d=async(m,f)=>{var j;try{await r.mutateAsync({cardId:s.cardId,isCorrect:m,setId:f}),console.log(`Score update successful for card ${s.cardId}, set ${f}`),(j=s.onAdvance)==null||j.call(s)}catch(y){console.error(`Failed to update score for card ${s.cardId}, set ${f}: `,y),i(y)}},u=()=>{d(!1,c)},l=()=>{d(!0,c)};return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[n&&e.jsxs("div",{className:"text-red-500",children:["Error: ",n.message]}),e.jsxs("div",{className:`flip-card cursor-pointer ${a?"flipped":""}`,onClick:()=>t(!a),children:[e.jsx(ge,{className:"flip-card-front p-8 min-h-[300px] flex items-center justify-center text-center",children:e.jsx("p",{className:"text-xl",children:s.front})}),e.jsx(ge,{className:"flip-card-back p-8 min-h-[300px] flex items-center justify-center text-center absolute top-0 w-full",children:e.jsx("p",{className:"text-xl",children:s.back})})]}),e.jsxs("div",{className:"flex justify-center gap-4 mt-6",children:[e.jsxs(re,{variant:"outline",id:"shadcn-button",className:"w-32",onClick:u,children:[e.jsx(js,{className:"mr-2 h-4 w-4"}),"Not yet"]}),e.jsxs(re,{id:"shadcn-button",className:"w-32",onClick:l,children:[e.jsx(pt,{className:"mr-2 h-4 w-4"}),"Got it"]})]})]})},qs=o.createContext(null);function Qe(){const s=o.useContext(qs);if(!s)throw new Error("useCarousel must be used within a <Carousel />");return s}const Os=o.forwardRef(({orientation:s="horizontal",opts:a,setApi:t,plugins:r,className:n,children:i,...c},d)=>{const[u,l]=wt({...a,axis:s==="horizontal"?"x":"y"},r),[m,f]=o.useState(!1),[j,y]=o.useState(!1),x=o.useCallback(C=>{C&&(f(C.canScrollPrev()),y(C.canScrollNext()))},[]),g=o.useCallback(()=>{l==null||l.scrollPrev()},[l]),h=o.useCallback(()=>{l==null||l.scrollNext()},[l]),N=o.useCallback(C=>{C.key==="ArrowLeft"?(C.preventDefault(),g()):C.key==="ArrowRight"&&(C.preventDefault(),h())},[g,h]);return o.useEffect(()=>{!l||!t||t(l)},[l,t]),o.useEffect(()=>{if(l)return x(l),l.on("reInit",x),l.on("select",x),()=>{l==null||l.off("select",x)}},[l,x]),e.jsx(qs.Provider,{value:{carouselRef:u,api:l,opts:a,orientation:s||((a==null?void 0:a.axis)==="y"?"vertical":"horizontal"),scrollPrev:g,scrollNext:h,canScrollPrev:m,canScrollNext:j},children:e.jsx("div",{ref:d,onKeyDownCapture:N,className:E("relative",n),role:"region","aria-roledescription":"carousel",...c,children:i})})});Os.displayName="Carousel";const Rs=o.forwardRef(({className:s,...a},t)=>{const{carouselRef:r,orientation:n}=Qe();return e.jsx("div",{ref:r,className:"overflow-hidden",children:e.jsx("div",{ref:t,className:E("flex",n==="horizontal"?"-ml-4":"-mt-4 flex-col",s),...a})})});Rs.displayName="CarouselContent";const Us=o.forwardRef(({className:s,...a},t)=>{const{orientation:r}=Qe();return e.jsx("div",{ref:t,role:"group","aria-roledescription":"slide",className:E("min-w-0 shrink-0 grow-0 basis-full",r==="horizontal"?"pl-4":"pt-4",s),...a})});Us.displayName="CarouselItem";const Sa=o.forwardRef(({className:s,variant:a="outline",size:t="icon",...r},n)=>{const{orientation:i,scrollPrev:c,canScrollPrev:d}=Qe();return e.jsxs(re,{ref:n,variant:a,size:t,className:E("absolute  h-8 w-8 rounded-full",i==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!d,onClick:c,...r,children:[e.jsx(vt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Previous slide"})]})});Sa.displayName="CarouselPrevious";const ka=o.forwardRef(({className:s,variant:a="outline",size:t="icon",...r},n)=>{const{orientation:i,scrollNext:c,canScrollNext:d}=Qe();return e.jsxs(re,{ref:n,variant:a,size:t,className:E("absolute h-8 w-8 rounded-full",i==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!d,onClick:c,...r,children:[e.jsx(Nt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Next slide"})]})});ka.displayName="CarouselNext";const Ia=()=>{const{id:s}=es(),[a]=je(),[t,r]=o.useState(),[n,i]=o.useState(0),{data:c,isLoading:d,error:u}=va(s),{data:l=[],isLoading:m,error:f}=Na(s),j=d||m,y=u||f;if(y){console.error("Query error:",y);let h="Unknown error";y instanceof Error&&(h=y.message),a({message:`Error loading data: ${h}`,duration:3e3,color:"danger"})}o.useEffect(()=>{if(!t)return;const h=()=>{i(t.selectedScrollSnap())};return h(),t.on("select",h),t.on("reInit",h),()=>{t.off("select",h),t.off("reInit",h)}},[t]);const x=()=>{t&&l.length>0&&(n===l.length-1?a({message:"Congratulations! You have completed the set.",duration:3e3,color:"success"}):t.scrollNext())},g=l.length?Math.round((n+1)/l.length*100):0;return e.jsxs(U,{children:[e.jsx(X,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(p,{className:"rounded-lg",style:{"--border-radius":"0.5rem"},routerLink:`/set-overview/${s}`,children:[e.jsx(T,{slot:"start",icon:_e}),"Back"]}),e.jsx("div",{children:j?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx($,{name:"dots"}),e.jsx($,{name:"dots"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl font-bold",children:c==null?void 0:c.SetName}),e.jsx("p",{className:"text-gray-500",children:c==null?void 0:c.SetDescription})]})})]}),e.jsx("div",{className:"w-full max-w-xl mx-auto relative py-8 min-h-[400px] flex flex-col items-center justify-center",children:j?e.jsx($,{name:"circular"}):l.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg py-20",children:"This set has no cards yet."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full mb-4 bg-gray-200 rounded-full h-2.5 dark:bg-gray-700",children:e.jsx("div",{className:"bg-primary h-2.5 rounded-full transition-all duration-300",style:{width:`${g}%`}})}),e.jsxs("div",{className:"text-sm text-gray-500 mb-4",children:["Card ",n+1," of ",l.length]}),e.jsx(Os,{orientation:"vertical",setApi:r,className:"w-full",children:e.jsx(Rs,{className:"-mt-1 h-[400px]",children:l==null?void 0:l.map((h,N)=>e.jsx(Us,{children:e.jsx(Ca,{front:h.Front,back:h.Back,onAdvance:x,cardId:h.ID,setId:s})},N))})})]})})]})}),e.jsx(W,{})]})},Ea=()=>{const[s,a]=o.useState("classes"),{data:t=[],isLoading:r,error:n}=_s(),{data:i,isLoading:c,error:d}=ss(),u=n||d;return e.jsxs(U,{children:[e.jsx(X,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8 flex-grow",children:[u&&e.jsx("div",{className:"text-red-500 mt-2",children:u.message}),e.jsxs("div",{className:"flex flex-col me:flex-row me:justify-between me:items-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-smokum font-bold",children:s==="classes"?"My Classes":"My Flashcard Sets"}),e.jsx("div",{className:"flex items-center gap-2 mt-4 me:mt-0",children:e.jsxs(p,{color:"primary",className:"rounded-lg",style:{"--border-radius":"0.5rem"},routerLink:s==="classes"?"/public-classes":"/public-cards",children:[e.jsx(T,{slot:"start",icon:Ze})," ",s==="classes"?"Join Class":"Join Set"]})})]}),e.jsx("div",{className:"mb-8",children:e.jsxs(Ns,{value:s,onIonChange:l=>a(l.detail.value||"classes"),style:{"--background":"var(--ion-color-light)"},children:[e.jsxs(ve,{value:"classes",children:[e.jsx(T,{icon:bt,className:"mr-2"}),e.jsx(xe,{children:"My Classes"})]}),e.jsxs(ve,{value:"flashcards",children:[e.jsx(T,{icon:bs,className:"mr-2"}),e.jsx(xe,{children:"My Cards"})]})]})}),s==="classes"&&e.jsx(e.Fragment,{children:r?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx($,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading classes..."})]}):t===null?e.jsx("div",{className:"text-center p-8 text-gray-600",children:"You are not part of any classes. Join a class to get started."}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t==null?void 0:t.map(l=>e.jsx(he,{to:`/class/${l.ClassID}`,children:e.jsxs(q,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:[e.jsxs(Y,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(H,{className:"text-2xl font-semibold leading-none tracking-tight",children:l.ClassName}),e.jsx(Le,{className:"text-sm text-muted-foreground",children:l.ClassDescription})]}),e.jsx(V,{})]})},l.ClassID))})}),s==="flashcards"&&e.jsx(e.Fragment,{children:c?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx($,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading sets..."})]}):i===null?e.jsx("div",{className:"text-center p-8 text-gray-600",children:"You are not part of any sets. Join a set to get started."}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:i==null?void 0:i.map(l=>e.jsx(he,{to:`/set-overview/${l.SetID}`,children:e.jsxs(q,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:[e.jsxs(Y,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(H,{className:"text-2xl font-semibold leading-none tracking-tight",children:l.SetName}),e.jsx(Le,{className:"text-sm text-muted-foreground",children:l.SetDescription})]}),e.jsx(V,{})]})},l.SetID))})})]})}),e.jsx(W,{})]})},Da=()=>e.jsx(U,{children:e.jsx(L,{children:e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center from-white to-gray-50",children:[e.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16 mt-6 sm:mt-10 md:mt-14 mx-2",children:[e.jsx("h1",{className:"text-5xl sm:text-6xl md:text-7xl text-primary mb-4 font-ewert",children:"Cowboy Cards"}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-rye",children:"Master any subject with smart flashcards"})]}),e.jsx(Is,{})]})})}),Ta=()=>{const s=Ce();return o.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",s.pathname)},[s.pathname]),e.jsx(U,{children:e.jsx(L,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),e.jsx("a",{href:"/home",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})})})},Pa=()=>{const s=M(),[a,t]=o.useState(null),[r,n]=o.useState(!1),[i,c]=o.useState([]),[d,u]=o.useState(""),[l]=je(),{data:m,isLoading:f}=ss(),j=i.filter(x=>x.SetName.toLowerCase().includes(d.toLowerCase())||x.SetDescription&&x.SetDescription.toLowerCase().includes(d.toLowerCase()));o.useEffect(()=>{async function x(){n(!0),t(null);try{const g=await v("/api/flashcards/sets/list");c(g)}catch(g){console.error("Error fetching flashcard sets:",g),t(`Error fetching flashcard sets: ${g.message}`)}finally{n(!1)}}x()},[]);const y=x=>m?m.some(g=>g.SetID===x):!1;return e.jsxs(U,{children:[e.jsx(X,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-0 py-8 w-4/5",children:[e.jsxs("div",{className:"flex items-center flex-col justify-between mb-4",children:[e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum pb-8",children:"Public Flashcard Sets"}),r||f&&e.jsx("div",{children:"Loading..."}),a&&e.jsx("div",{className:"text-red-500 mt-2",children:a}),e.jsx(ks,{value:d,onIonInput:x=>u(x.target.value),placeholder:"Search flashcard sets",className:"mb-4 max-w-lg"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:j==null?void 0:j.map(x=>!y(x.ID)&&e.jsx(he,{to:`/set-overview/${x.ID}`,children:e.jsx(q,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:e.jsxs(Y,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(H,{className:"text-2xl font-semibold leading-none tracking-tight",children:x.SetName}),e.jsx(Le,{className:"text-sm ",children:x.SetDescription||"No description"}),e.jsx(p,{expand:"block",color:"primary",className:"mt-4",onClick:async g=>{try{const h=await v("/api/set_user",{method:"POST",headers:{set_id:x.ID,role:"user"}});console.log("Join set response:",h),l({message:"Successfully joined set",duration:2e3,color:"success"}),s.invalidateQueries({queryKey:["userSets"]})}catch(h){console.error("Error joining set:",h)}},children:"Join Set"})]})})},x.ID))})]})}),e.jsx(W,{})]})},Aa=()=>{const s=M(),[a,t]=o.useState([]),[r,n]=o.useState(!1),[i,c]=o.useState(null),[d,u]=o.useState(""),[l]=je(),{data:m,isLoading:f}=_s(),j=x=>m?m.some(g=>g.ClassID===x):!1,y=a.filter(x=>x.ClassName.toLowerCase().includes(d.toLowerCase())||x.ClassDescription&&x.ClassDescription.toLowerCase().includes(d.toLowerCase()));return o.useEffect(()=>{(async()=>{n(!0),c(null);try{const g=await v("/api/classes/list");t(g)}catch(g){c(`Error fetching classes: ${g.message}`)}finally{n(!1)}})()},[]),e.jsxs(U,{children:[e.jsx(X,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-0 py-8 w-4/5",children:[e.jsxs("div",{className:"flex items-center flex-col justify-between mb-4",children:[e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum pb-8",children:"Public Classes"}),(r||f)&&e.jsx("div",{children:"Loading..."}),i&&e.jsx("div",{className:"text-red-500 mt-2",children:i}),e.jsx(ks,{value:d,onIonInput:x=>u(x.target.value),placeholder:"Search classes",className:"mb-4 max-w-lg"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:y==null?void 0:y.map(x=>!j(x.ID)&&e.jsx(he,{to:`/class/${x.ID}`,children:e.jsx(q,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:e.jsxs(Y,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(H,{className:"text-2xl font-semibold leading-none tracking-tight",children:x.ClassName}),e.jsx(Le,{className:"text-sm ",children:x.ClassDescription||"No description"}),e.jsx(p,{expand:"block",color:"primary",className:"mt-4",onClick:async()=>{try{const g=await v("/api/class_user",{method:"POST",headers:{class_id:x.ID,role:"student"}});console.log("Join class response:",g),l({message:"Successfully joined class",duration:2e3,color:"success"}),s.invalidateQueries({queryKey:["userClasses"]})}catch(g){console.error("Error joining class:",g)}},children:"Join Class"})]})})},x.ID))})]})}),e.jsx(W,{})]})},La=s=>{var t;const a=Array.isArray(s.cardsToDisplay)&&s.cardsToDisplay.length>0;return e.jsx("div",{className:"mt-8 min-h-[200px]",children:s.loading?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx($,{name:"circular"})}):!a&&!s.isEditing?e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-gray-900 dark:text-gray-400 mb-4",children:"This set has no cards yet."}),s.isOwner&&e.jsx(p,{color:"primary",className:"rounded-lg",style:{"--border-radius":"0.5rem"},onClick:s.onAddCardClick,children:"Add Cards"})]}):e.jsxs("div",{className:"w-full",children:[(t=s.cardsToDisplay)==null?void 0:t.map((r,n)=>{var i,c,d,u;return s.isEditing&&s.isOwner?e.jsxs(q,{className:"mb-4 rounded-lg border shadow-sm p-4",children:[e.jsxs(z,{lines:"none",children:[e.jsxs(ae,{className:"text-md font-semibold text-gray-900 dark:text-gray-300 mr-auto",children:["Card ",n+1]}),e.jsx(p,{fill:"clear",color:"danger",size:"small",onClick:()=>s.onRemoveCard(n),children:e.jsx(T,{slot:"icon-only",icon:Cs})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mt-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(fe,{label:"Front",labelPlacement:"stacked",value:r.Front,onIonInput:l=>s.onCardChange(n,"Front",l.detail.value),className:`w-full border rounded-md p-2 ${(i=s.cardErrors[n])!=null&&i.front?"border-red-500":"border-gray-300"}`,autoGrow:!0,rows:3}),((c=s.cardErrors[n])==null?void 0:c.front)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.cardErrors[n].front})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(fe,{label:"Back",labelPlacement:"stacked",value:r.Back,onIonInput:l=>s.onCardChange(n,"Back",l.detail.value),className:`w-full border rounded-md p-2 ${(d=s.cardErrors[n])!=null&&d.back?"border-red-500":"border-gray-300"}`,autoGrow:!0,rows:3}),((u=s.cardErrors[n])==null?void 0:u.back)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.cardErrors[n].back})]})]})]},r.ID<=0?`new-${n}`:r.ID):e.jsx(q,{className:"mb-4 rounded-lg border shadow-sm",children:e.jsxs(V,{children:[e.jsx("div",{className:"border-b border-gray-300 mb-3 pb-1 m-4",children:e.jsxs(ae,{className:"text-md font-semibold text-gray-900 dark:text-gray-300",children:["Card ",n+1]})}),e.jsxs("div",{className:"flex flex-row justify-between items-start",children:[e.jsx("div",{className:"w-3/12 pr-4 border-r border-gray-300 m-4",children:e.jsx(ae,{className:"block whitespace-pre-wrap text-lg text-gray-900 dark:text-gray-200",children:r.Front})}),e.jsx("div",{className:"w-9/12 pl-4 m-4",children:e.jsx(ae,{className:"block whitespace-pre-wrap text-lg text-gray-900 dark:text-gray-200",children:r.Back})})]})]})},r.ID)}),s.isEditing&&s.isOwner&&e.jsxs(p,{expand:"block",onClick:s.onAddCard,className:"mt-4 rounded-lg",children:[e.jsx(T,{slot:"start",icon:Ze}),"Add New Card"]})]})})},Fa=s=>e.jsxs("div",{className:"flex flex-col items-center sm:items-end justify-end mt-4",children:[e.jsx(p,{className:"rounded-lg sm:ml-0 w-full sm:w-auto max-w-80",color:"primary",style:{"--border-radius":"0.5rem"},routerLink:s.studyLink,disabled:s.isEditing,children:"Study Set"}),s.isOwner&&!s.isEditing&&e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"rounded-lg mt-2 sm:mt-2 sm:ml-2 w-full sm:w-auto max-w-80",style:{"--border-radius":"0.5rem"},onClick:s.onEditClick,children:"Edit Set & Cards"}),e.jsx(p,{className:"rounded-lg mt-2 sm:mt-2 sm:ml-2 w-full sm:w-auto max-w-80",color:"danger",style:{"--border-radius":"0.5rem"},onClick:s.onDeleteClick,children:"Delete Set"})]}),s.isOwner&&s.isEditing&&e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"rounded-lg mt-2 sm:mt-2 sm:ml-2 w-full sm:w-auto max-w-80",color:"primary",size:"small",onClick:s.onSaveClick,children:"Save All Changes"}),e.jsx(p,{className:"rounded-lg mt-2 sm:mt-2 sm:ml-2 w-full sm:w-auto max-w-80",color:"medium",size:"small",onClick:s.onCancelClick,children:"Cancel"})]})]}),_a=s=>e.jsx("div",{className:"gap-4 flex-1 sm:pr-4",children:e.jsx("div",{className:"flex flex-col",children:s.loading||!s.flashcardSetData?e.jsx($,{name:"dots"}):s.isEditing&&s.isOwner?e.jsxs(e.Fragment,{children:[e.jsx(ie,{type:"text",label:"Set Name",name:"set_name",value:s.updatedInfo.set_name,onChange:s.onMetadataChange,error:s.metadataErrors.setName}),e.jsx(ie,{type:"text",label:"Set Description",name:"set_description",value:s.updatedInfo.set_description,onChange:s.onMetadataChange,error:s.metadataErrors.setDescription}),s.metadataErrors.general&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.metadataErrors.general})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s.flashcardSetData.SetName||"Untitled Set"}),e.jsx("p",{className:"text-base mt-1 text-gray-700 dark:text-gray-400",children:s.flashcardSetData.SetDescription||"No description available"}),e.jsxs(p,{className:"rounded-lg mt-4 max-w-[200px]",style:{"--border-radius":"0.5rem"},onClick:s.onBackClick,disabled:s.isEditing,children:[e.jsx(T,{slot:"start",icon:_e}),"Back"]})]})})});function qa(s,a=!0){return ee({queryKey:["set",s],queryFn:()=>v("/api/flashcards/sets/",{method:"GET",headers:{id:s}}),enabled:a&&!!s,staleTime:5*60*1e3})}function Oa(s,a=!0){return ee({queryKey:["setCards",s],queryFn:()=>v("/api/flashcards/list",{method:"GET",headers:{set_id:s}}),enabled:a&&!!s,staleTime:5*60*1e3})}function Ra(){const s=M();return ne({mutationFn:({id:a,field:t,value:r})=>v(`/api/flashcards/sets/${t}`,{method:"PUT",headers:{id:a,[t]:r}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["set",t.id]}),s.invalidateQueries({queryKey:["userSets"]})}})}function Ua(){const s=M();return ne({mutationFn:({id:a,field:t,value:r})=>v(`/api/flashcards/${t}`,{method:"PUT",headers:{id:a,[t]:r}}),onSuccess:(a,t)=>{const n=s.getQueryCache().findAll({queryKey:["setCards"]}).map(i=>i.queryKey[1]).find(i=>{const c=s.getQueryData(["setCards",i]);return c==null?void 0:c.some(d=>d.ID===t.id)});n&&s.invalidateQueries({queryKey:["setCards",n]})}})}function Ma(){const s=M();return ne({mutationFn:({setId:a,front:t,back:r})=>v("/api/flashcards",{method:"POST",headers:{front:t,back:r,set_id:a}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["setCards",t.setId.toString()]})}})}function $a(){const s=M();return ne({mutationFn:a=>v("/api/flashcards",{method:"DELETE",headers:{id:a}}),onSuccess:(a,t)=>{const n=s.getQueryCache().findAll({queryKey:["setCards"]}).map(i=>i.queryKey[1]).find(i=>{const c=s.getQueryData(["setCards",i]);return c==null?void 0:c.some(d=>d.ID===t)});n&&s.invalidateQueries({queryKey:["setCards",n]})}})}function Ba(){const s=M();return ne({mutationFn:a=>v("/api/flashcards/sets/",{method:"DELETE",headers:{id:a}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["userSets"]})}})}const Ka=()=>{var as;const{id:s}=es(),a=Se(),[t]=je(),n=(as=Ce().state)==null?void 0:as.fromClassId,[i,c]=o.useState(!1),d=M(),{data:u,isLoading:l,error:m}=qa(s,!i),{data:f=[],isLoading:j,error:y}=Oa(s,!i),x=Ra(),g=Ua(),h=Ma(),N=$a(),C=Ba(),[oe,se]=o.useState(!1),[B,Z]=o.useState(!1),[b,k]=o.useState([]),[K,ce]=o.useState({set_name:"",set_description:""}),[S,P]=o.useState({}),[Q,_]=o.useState({}),ye=(u==null?void 0:u.Role)==="owner",pe=l||j,de=m||y;if(de){console.error("Query error:",de);let I="Unknown error";de instanceof Error&&(I=de.message),t({message:`Error loading data: ${I}`,duration:3e3,color:"danger"})}const ke=()=>{u&&(ce({set_name:u.SetName||"",set_description:u.SetDescription||""}),k((f||[]).map(I=>({...I}))),Z(!0),P({}),_({}))},ze=I=>{const{name:D}=I.target,A=I.detail.value??"";ce(w=>({...w,[D]:A}))},Ie=(I,D,A)=>{const w=A??"";k(F=>F==null?void 0:F.map((ue,we)=>we===I?{...ue,[D]:w}:ue))},Ee=()=>{if(!u)return;const I={ID:0-(b||[]).filter(D=>D.ID<=0).length-1,Front:"",Back:"",SetID:u.ID,CreatedAt:new Date().toISOString(),UpdatedAt:new Date().toISOString()};k(D=>[...D||[],I])},O=I=>{k(D=>D.filter((A,w)=>w!==I))},le=()=>{const I={};let D=!0;const A=K.set_name.trim(),w=K.set_description.trim();return A||(I.setName="Set name is required",D=!1),w||(I.setDescription="Set description is required",D=!1),P(I),ce({set_name:A,set_description:w}),D},Ve=()=>{const I={};let D=!0;return b.forEach((A,w)=>{const F={},ue=A.Front.trim(),we=A.Back.trim();ue||(F.front="Front cannot be empty",D=!1),we||(F.back="Back cannot be empty",D=!1),Object.keys(F).length>0&&(I[w]=F),(ue!==A.Front||we!==A.Back)&&k(Je=>Je==null?void 0:Je.map((rs,Ks)=>Ks===w?{...rs,Front:ue,Back:we}:rs))}),_(I),D},Ge=async()=>{const I=le(),D=Ve();if(!I||!D||!u){console.log("Form validation failed:",S,Q),t({message:"Please fix validation errors before saving.",duration:3e3,color:"warning"});return}try{K.set_name!==(u.SetName||"").trim()&&await x.mutateAsync({id:s,field:"set_name",value:K.set_name}),K.set_description!==(u.SetDescription||"").trim()&&await x.mutateAsync({id:s,field:"set_description",value:K.set_description});const A=new Map((f||[]).map(w=>[w.ID,w]));for(const w of f||[])!b.some(F=>F.ID===w.ID)&&w.ID>0&&await N.mutateAsync(w.ID);for(const w of b)if(w.ID<=0)await h.mutateAsync({setId:u.ID,front:w.Front,back:w.Back});else{const F=A.get(w.ID);F&&(w.Front!==(F.Front||"").trim()&&await g.mutateAsync({id:w.ID,field:"front",value:w.Front}),w.Back!==(F.Back||"").trim()&&await g.mutateAsync({id:w.ID,field:"back",value:w.Back}))}t({message:"Set details and cards updated successfully!",duration:2e3,color:"success"}),Z(!1),P({}),_({})}catch(A){console.error("Failed to update set:",A);let w="Unknown error during save";A instanceof Error&&(w=A.message),P(F=>({...F,general:`Failed to save: ${w}`})),t({message:`Failed to save changes: ${w}`,duration:3e3,color:"danger"})}},Ms=()=>{Z(!1),P({}),_({})},$s=async()=>{if(!s){console.error("Cannot delete set: ID is missing."),t({message:"Cannot delete: Set ID missing.",duration:3e3,color:"danger"});return}c(!0);try{await C.mutateAsync(s),d.removeQueries({queryKey:["set",s],exact:!0}),d.removeQueries({queryKey:["setCards",s],exact:!0}),t({message:"Set deleted successfully.",duration:2e3,color:"success"}),a.push("/home")}catch(I){console.error("Failed to delete set:",I);let D="Unknown error during deletion";I instanceof Error&&(D=I.message),t({message:`Failed to delete set: ${D}`,duration:3e3,color:"danger"})}},ts=()=>{B||(n?a.push(`/class/${n}`):a.push("/home"))},Bs=B?b:f;return pe&&!B?e.jsxs(U,{children:[e.jsxs(L,{className:"",children:[e.jsx(X,{}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($,{name:"circular"})})]}),e.jsx(W,{})]}):e.jsxs(U,{children:[e.jsx(X,{}),e.jsxs(L,{children:[e.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx(_a,{loading:pe,flashcardSetData:u,isEditing:B,isOwner:ye,updatedInfo:K,metadataErrors:S,onMetadataChange:ze,onBackClick:ts}),e.jsx(Fa,{isOwner:ye,isEditing:B,onBackClick:ts,onEditClick:ke,onSaveClick:Ge,onCancelClick:Ms,onDeleteClick:()=>se(!0),studyLink:`/flashcards/${s}`})]}),e.jsx(La,{loading:pe,cardsToDisplay:Bs,isEditing:B,isOwner:ye,cardErrors:Q,onCardChange:Ie,onAddCard:Ee,onRemoveCard:O,onAddCardClick:ke})]}),e.jsx(Ae,{isOpen:oe,onDidDismiss:()=>se(!1),header:"Confirm Deletion",message:"Are you sure you want to delete this set? This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary"},{text:"Delete",role:"destructive",handler:$s}]})]}),e.jsx(W,{})]})},te=s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:[s.label,":"]}),e.jsx("span",{children:s.value})]}),Qa=s=>{var a,t,r,n,i,c,d,u,l,m,f,j,y,x;return e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs(q,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(Y,{className:"p-6",children:e.jsx(H,{className:"text-xl font-rye font-semibold text-primary",children:"Account Information"})}),e.jsx(V,{className:"p-6 pt-0",children:s.isEditing?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ie,{type:"text",label:"First Name",name:"first_name",value:((a=s.updatedInfo)==null?void 0:a.first_name)||"",error:s.errors.first_name,onChange:s.handleChange}),e.jsx(ie,{type:"text",label:"Last Name",name:"last_name",value:((t=s.updatedInfo)==null?void 0:t.last_name)||"",error:s.errors.last_name,onChange:s.handleChange}),e.jsx(ie,{type:"text",label:"Username",name:"username",value:((r=s.updatedInfo)==null?void 0:r.username)||"",error:s.errors.username,onChange:s.handleChange}),e.jsx(ie,{type:"email",label:"Email",name:"email",value:((n=s.updatedInfo)==null?void 0:n.email)||"",error:s.errors.email,onChange:s.handleChange}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(p,{onClick:s.handleSave,children:"Save Changes"})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{label:"First Name",value:(i=s.userInfo)==null?void 0:i.first_name}),e.jsx(te,{label:"Last Name",value:(c=s.userInfo)==null?void 0:c.last_name}),e.jsx(te,{label:"Username",value:(d=s.userInfo)==null?void 0:d.username}),e.jsx(te,{label:"Email",value:(u=s.userInfo)==null?void 0:u.email}),e.jsxs(p,{onClick:s.handleEdit,className:"mt-4",children:[e.jsx(T,{slot:"start",icon:vs}),"Edit Info"]})]})})]}),e.jsxs(q,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(Y,{className:"p-6",children:e.jsx(H,{className:"text-xl font-rye font-semibold text-primary",children:"Account Stats"})}),e.jsx(V,{className:"p-6 pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(te,{label:"Account Created",value:(l=s.userInfo)==null?void 0:l.created_at}),e.jsx(te,{label:"Login Streak",value:(m=s.userInfo)==null?void 0:m.login_streak}),e.jsx(te,{label:"Classes Taken",value:(f=s.userInfo)==null?void 0:f.numClasses}),e.jsx(te,{label:"Cards Studied/Total Views",value:`${(j=s.userInfo)==null?void 0:j.cardsStudied} / ${(y=s.userInfo)==null?void 0:y.totalCardViews}`}),e.jsx(te,{label:"Total Score",value:(x=s.userInfo)==null?void 0:x.totalScore})]})})]})]})},ds=256;function za(s){const[a,t]=o.useState(0),{ref:r,inView:n}=Ct({threshold:.7,triggerOnce:!0});return o.useEffect(()=>{let i=1e3;if(n){const c=setTimeout(()=>t(a+1),i*=.75);a==s.streak-1&&clearTimeout(c)}},[a,s.streak,n]),e.jsxs(q,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(Y,{className:"p-6",children:e.jsx(H,{className:"text-xl font-rye font-semibold text-primary",children:"Login Streak"})}),e.jsxs(V,{ref:r,className:"py-6 px-0 flex flex-row items-center justify-center gap-8",children:[e.jsx("img",{src:`/frame-${a}.png`,alt:"bonsai tree",width:ds,height:ds}),e.jsx("span",{className:"text-6xl px-4 font-rye font-extrabold text-[color:--ion-color-primary] tabular-nums -ml-[30%] me:ml-0",children:a+1})]})]})}const Va=s=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 py-6",children:[e.jsx(za,{streak:s.streak}),e.jsxs(q,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(Y,{className:"p-6",children:e.jsx(H,{className:"text-xl font-rye font-semibold text-primary",children:"Account Options"})}),e.jsx(V,{className:"p-6 pt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(St,{label:"Theme",value:s.theme,onIonChange:a=>s.setTheme(a.detail.value),interface:"popover",placeholder:"Select Theme",children:[e.jsx(os,{value:"light",children:"Light"}),e.jsx(os,{value:"dark",children:"Dark"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"mr-4",children:[e.jsx("h4",{className:"text-sm font-medium text-black dark:text-white",children:"Change Your Password"}),e.jsx("p",{className:"text-xs dark:text-gray-300",children:"Reset your account password."})]}),e.jsx(p,{color:"primary",onClick:()=>s.setShowPasswordAlert(!0),children:"Change Password"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"mr-4",children:[e.jsx("h4",{className:"text-sm font-medium text-black dark:text-white",children:"Delete Your Account"}),e.jsx("p",{className:"text-xs dark:text-gray-300",children:"This will delete all account data and can't be undone."})]}),e.jsx(p,{color:"danger",onClick:()=>s.setShowDeleteAlert(!0),children:"Delete Account"})]})]})})]})]}),e.jsx(Ae,{isOpen:s.showPasswordAlert,onDidDismiss:()=>s.setShowPasswordAlert(!1),header:"Change Password",inputs:[{name:"newPassword",type:"password",placeholder:"New Password"},{name:"confirmPassword",type:"password",placeholder:"Confirm New Password"}],buttons:[{text:"Cancel",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Save",handler:async a=>{if(a.newPassword!==a.confirmPassword)return s.presentToast({message:"Passwords do not match",duration:4e3,color:"danger"}),!0;try{const t=await v("/api/users/password",{method:"PUT",headers:{password:a.newPassword}});console.log(t),s.presentToast({message:"Password changed.",duration:5e3,color:"success"})}catch(t){s.presentToast({message:"Error changing password: "+t,duration:7e3,color:"danger"})}return!0}}]}),e.jsx(Ae,{isOpen:s.showDeleteAlert,onDidDismiss:()=>s.setShowDeleteAlert(!1),header:"Confirm Deletion",message:"Are you sure you want to delete your account? This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Delete",handler:async()=>{try{const a=await v("/api/users/",{method:"DELETE",headers:{}});console.log(a),s.presentToast({message:"Account deleted. Please close your browser.",duration:5e3,color:"success"})}catch(a){s.presentToast({message:"Error deleting account: "+a,duration:7e3,color:"danger"})}return!0}}]})]}),Ga=()=>{const{theme:s,setTheme:a}=Ds(),[t,r]=o.useState(),[n,i]=o.useState(!0),[c,d]=o.useState(null),[u,l]=o.useState(null),[m,f]=o.useState(!1),[j,y]=o.useState(!1),[x,g]=o.useState(!1),[h,N]=o.useState(t),C=S=>{l(u===S?null:S)},oe=()=>{N(t),g(!0)},se=async()=>{var P;if(!B())return;const S=["first_name","last_name","username","email"];try{const Q=(P=S==null?void 0:S.filter(_=>h[_]!==t[_]))==null?void 0:P.map(_=>v(`/api/users/${_}`,{method:"PUT",headers:{[_]:h[_]}}));await Promise.all(Q),r(h),g(!1)}catch(Q){console.error(Q),alert("Failed to update some fields. Please try again.")}},B=()=>{const S={};let P=!0;return h.first_name||(S.first_name="First name is required",P=!1),h.last_name||(S.last_name="Last name is required",P=!1),h.email?/\S+@\S+\.\S+/.test(h.email)||(S.email="Email is invalid",P=!1):(S.email="Email is required",P=!1),h.username||(S.username="Username is required",P=!1),h.first_name=h.first_name.trim(),h.last_name=h.last_name.trim(),h.email=h.email.trim(),h.username=h.username.trim(),b(S),P},[Z,b]=o.useState({}),k=S=>{const{name:P}=S.target,Q=S.detail.value;N(_=>({..._,[P]:Q}))},K=o.useCallback(async()=>{i(!0),d(null);try{const S=await v("/api/users/");r(S),N(S),console.log("data",S)}catch(S){console.log(`Failed to fetch User Data: ${S.message}`),d(`Failed to fetch User Data: ${S.message}`)}finally{i(!1)}},[]);kt(()=>{console.log("UserAccount will enter, fetching data..."),K()});const[ce]=je();return e.jsxs(U,{children:[e.jsx(X,{}),e.jsx(L,{children:e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("p",{className:"text-xl font-rye font-semibold text-primary",children:n?"Loading...":`Welcome back, ${(t==null?void 0:t.username)||"User"}!`})}),e.jsxs(p,{onClick:()=>window.history.back(),className:"mb-6",children:[e.jsx(T,{slot:"start",icon:_e}),"Back"]}),n&&e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx($,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading account details..."})]}),c&&!n&&e.jsx("div",{className:"text-red-500 text-center p-4 border border-red-500 rounded-md",children:c}),!n&&!c&&t&&e.jsxs(e.Fragment,{children:[e.jsx(Qa,{isEditing:x,errors:Z,handleChange:k,handleSave:se,updatedInfo:h,userInfo:t,handleEdit:oe}),e.jsx(Va,{streak:(t==null?void 0:t.login_streak)??0,isEditing:x,errors:Z,handleChange:k,handleSave:se,updatedInfo:h,userInfo:t,expandedClass:u,toggleClassDetails:C,showPasswordAlert:m,setShowPasswordAlert:f,showDeleteAlert:j,setShowDeleteAlert:y,theme:s,setTheme:a,presentToast:ce})]})]})}),e.jsx(W,{})]})};It();const Ja=new Et;function Ya(){return e.jsx(Dt,{client:Ja,children:e.jsx(Jt,{children:e.jsxs(ea,{children:[e.jsx(Tt,{children:e.jsxs(Pt,{children:[e.jsxs(o.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:[e.jsx(X,{}),e.jsxs(At,{id:"main-content",children:[e.jsx(R,{exact:!0,path:"/",component:Da}),e.jsx(R,{exact:!0,path:"/home",component:Ea}),e.jsx(R,{exact:!0,path:"/class/:id",component:ya}),e.jsx(R,{exact:!0,path:"/auth",component:Is}),e.jsx(R,{exact:!0,path:"/reset-password",component:Gt}),e.jsx(R,{exact:!0,path:"/confirm-reset-password",component:Vt}),e.jsx(R,{exact:!0,path:"/public-cards",component:Pa}),e.jsx(R,{exact:!0,path:"/user-account",component:Ga}),e.jsx(R,{exact:!0,path:"/flashcards/:id",component:Ia}),e.jsx(R,{exact:!0,path:"/create-set",component:wa}),e.jsx(R,{exact:!0,path:"/create-class",component:pa}),e.jsx(R,{exact:!0,path:"/public-classes",component:Aa}),e.jsx(R,{exact:!0,path:"/set-overview/:id",component:Ka}),e.jsx(R,{component:Ta})]})]}),e.jsx(W,{})]})}),e.jsx(Zt,{}),e.jsx(Yt,{})]})})})}const Ha=document.getElementById("root"),Wa=Lt(Ha);Wa.render(e.jsx(Ya,{}));export{sr as _,er as g};
//# sourceMappingURL=index-Cg8ji7Eh.js.map
